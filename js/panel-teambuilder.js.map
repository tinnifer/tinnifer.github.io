{"version":3,"file":"panel-teambuilder.js","names":["TeambuilderRoom","_PSRoom","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","DEFAULT_FORMAT","curFolder","curFolderKeep","_proto","prototype","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","target","PS","teams","push","createTeam","unshift","update","team","byKey","undelete","alert","copyFrom","name","format","folder","packedTeam","iconCache","key","endsWith","list","PSRoom","TeambuilderPanel","_PSRoomPanel","_this2","_len2","_key2","selectFolder","e","room","props","elem","className","getAttribute","parentElement","preventDefault","stopImmediatePropagation","forceUpdate","_proto2","renderFolderList","folderTable","folders","_i2","_PS$teams$list2","PSUtils","sortBy","parseInt","charAt","renderedFormatFolders","preact","h","TeamFolder","cur","value","renderedFolders","gen","_i4","newGen","folderOpenIcon","onClick","render","deletedTeams","undeleteIndex","splice","filterFolder","filterFormat","filter","PSPanelWrapper","style","map","TeamBox","PSRoomPanel","roomTypes","Model","Component","title"],"sources":["../src/panel-teambuilder.tsx"],"sourcesContent":["/**\r\n * Teambuilder panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass TeambuilderRoom extends PSRoom {\r\n\treadonly DEFAULT_FORMAT = 'gen8' as ID;\r\n\r\n\t/**\r\n\t * - `\"\"` - all\r\n\t * - `\"gen[NUMBER][ID]\"` - format folder\r\n\t * - `\"gen[NUMBER]\"` - uncategorized gen folder\r\n\t * - `\"[ID]/\"` - folder\r\n\t * - `\"/\"` - not in folder\r\n\t */\r\n\tcurFolder = '';\r\n\tcurFolderKeep = '';\r\n\r\n\t/**\r\n\t * @return true to prevent line from being sent to server\r\n\t */\r\n\thandleMessage(line: string) {\r\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\r\n\t\tconst spaceIndex = line.indexOf(' ');\r\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\r\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'newteam': {\r\n\t\t\tif (target === 'bottom') {\r\n\t\t\t\tPS.teams.push(this.createTeam());\r\n\t\t\t} else {\r\n\t\t\t\tPS.teams.unshift(this.createTeam());\r\n\t\t\t}\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'deleteteam': {\r\n\t\t\tconst team = PS.teams.byKey[target];\r\n\t\t\tif (team) PS.teams.delete(team);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'undeleteteam': {\r\n\t\t\tPS.teams.undelete();\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}}\r\n\r\n\t\t// unrecognized command\r\n\t\talert(`Unrecognized command: ${line}`);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tcreateTeam(copyFrom?: Team): Team {\r\n\t\tif (copyFrom) {\r\n\t\t\treturn {\r\n\t\t\t\tname: `Copy of ${copyFrom.name}`,\r\n\t\t\t\tformat: copyFrom.format,\r\n\t\t\t\tfolder: copyFrom.folder,\r\n\t\t\t\tpackedTeam: copyFrom.packedTeam,\r\n\t\t\t\ticonCache: null,\r\n\t\t\t\tkey: '',\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconst format = this.curFolder && !this.curFolder.endsWith('/') ? this.curFolder as ID : this.DEFAULT_FORMAT;\r\n\t\t\tconst folder = this.curFolder.endsWith('/') ? this.curFolder.slice(0, -1) : '';\r\n\t\t\treturn {\r\n\t\t\t\tname: `Untitled ${PS.teams.list.length + 1}`,\r\n\t\t\t\tformat,\r\n\t\t\t\tfolder,\r\n\t\t\t\tpackedTeam: '',\r\n\t\t\t\ticonCache: null,\r\n\t\t\t\tkey: '',\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass TeambuilderPanel extends PSRoomPanel<TeambuilderRoom> {\r\n\tselectFolder = (e: MouseEvent) => {\r\n\t\tconst room = this.props.room;\r\n\t\tlet elem = e.target as HTMLElement | null;\r\n\t\tlet folder: string | null = null;\r\n\t\twhile (elem) {\r\n\t\t\tif (elem.className === 'selectFolder') {\r\n\t\t\t\tfolder = elem.getAttribute('data-value') || '';\r\n\t\t\t\tbreak;\r\n\t\t\t} else if (elem.className === 'folderlist') {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telem = elem.parentElement;\r\n\t\t}\r\n\t\tif (folder === null) return;\r\n\t\troom.curFolderKeep = folder;\r\n\t\troom.curFolder = folder;\r\n\t\te.preventDefault();\r\n\t\te.stopImmediatePropagation();\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\trenderFolderList() {\r\n\t\tconst room = this.props.room;\r\n\t\t// The folder list isn't actually saved anywhere:\r\n\t\t// it's regenerated anew from the team list every time.\r\n\r\n\t\t// (This is why folders you create will automatically disappear\r\n\t\t// if you leave them without adding anything to them.)\r\n\r\n\t\tconst folderTable: {[folder: string]: 1 | undefined} = {'': 1};\r\n\t\tconst folders: string[] = [];\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tconst folder = team.folder;\r\n\t\t\tif (folder && !(`${folder}/` in folderTable)) {\r\n\t\t\t\tfolders.push(`${folder}/`);\r\n\t\t\t\tfolderTable[`${folder}/`] = 1;\r\n\t\t\t\tif (!('/' in folderTable)) {\r\n\t\t\t\t\tfolders.push('/');\r\n\t\t\t\t\tfolderTable['/'] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst format = team.format || room.DEFAULT_FORMAT;\r\n\t\t\tif (!(format in folderTable)) {\r\n\t\t\t\tfolders.push(format);\r\n\t\t\t\tfolderTable[format] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!(room.curFolderKeep in folderTable)) {\r\n\t\t\tfolderTable[room.curFolderKeep] = 1;\r\n\t\t\tfolders.push(room.curFolderKeep);\r\n\t\t}\r\n\t\tif (!(room.curFolder in folderTable)) {\r\n\t\t\tfolderTable[room.curFolder] = 1;\r\n\t\t\tfolders.push(room.curFolder);\r\n\t\t}\r\n\r\n\t\tPSUtils.sortBy(folders, folder => [\r\n\t\t\tfolder.endsWith('/') ? 10 : -parseInt(folder.charAt(3), 10),\r\n\t\t\tfolder,\r\n\t\t]);\r\n\r\n\t\tlet renderedFormatFolders = [\r\n\t\t\t<div class=\"foldersep\"></div>,\r\n\t\t\t<TeamFolder cur={false} value=\"+\">\r\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add format folder)</em>\r\n\t\t\t</TeamFolder>,\r\n\t\t];\r\n\r\n\t\tlet renderedFolders: preact.ComponentChild[] = [];\r\n\r\n\t\tlet gen = -1;\r\n\t\tfor (let format of folders) {\r\n\t\t\tconst newGen = format.endsWith('/') ? 0 : parseInt(format.charAt(3), 10);\r\n\t\t\tif (gen !== newGen) {\r\n\t\t\t\tgen = newGen;\r\n\t\t\t\tif (gen === 0) {\r\n\t\t\t\t\trenderedFolders.push(...renderedFormatFolders);\r\n\t\t\t\t\trenderedFormatFolders = [];\r\n\t\t\t\t\trenderedFolders.push(<div class=\"foldersep\"></div>);\r\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Folders</h3></div>);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Gen {gen}</h3></div>);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst folderOpenIcon = room.curFolder === format ? 'fa-folder-open' : 'fa-folder';\r\n\t\t\tif (gen === 0) {\r\n\t\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\r\n\t\t\t\t\t<i class={\r\n\t\t\t\t\t\t`fa ${folderOpenIcon}${format === '/' ? '-o' : ''}`\r\n\t\t\t\t\t}></i>\r\n\t\t\t\t\t{format.slice(0, -1) || '(uncategorized)'}\r\n\t\t\t\t</TeamFolder>);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\r\n\t\t\t\t<i class={`fa ${folderOpenIcon}-o`}></i>\r\n\t\t\t\t{format.slice(4) || '(uncategorized)'}\r\n\t\t\t</TeamFolder>);\r\n\t\t}\r\n\t\trenderedFolders.push(...renderedFormatFolders);\r\n\r\n\t\treturn <div class=\"folderlist\" onClick={this.selectFolder}>\r\n\t\t\t<div class=\"folderlistbefore\"></div>\r\n\r\n\t\t\t<TeamFolder cur={!room.curFolder} value=\"\">\r\n\t\t\t\t<em>(all)</em>\r\n\t\t\t</TeamFolder>\r\n\t\t\t{renderedFolders}\r\n\t\t\t<div class=\"foldersep\"></div>\r\n\t\t\t<TeamFolder cur={false} value=\"++\">\r\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add folder)</em>\r\n\t\t\t</TeamFolder>\r\n\r\n\t\t\t<div class=\"folderlistafter\"></div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tlet teams: (Team | null)[] = PS.teams.list.slice();\r\n\r\n\t\tif (PS.teams.deletedTeams.length) {\r\n\t\t\tconst undeleteIndex = PS.teams.deletedTeams[PS.teams.deletedTeams.length - 1][1];\r\n\t\t\tteams.splice(undeleteIndex, 0, null);\r\n\t\t}\r\n\r\n\t\tlet filterFolder: string | null = null;\r\n\t\tlet filterFormat: string | null = null;\r\n\t\tif (room.curFolder) {\r\n\t\t\tif (room.curFolder.slice(-1) === '/') {\r\n\t\t\t\tfilterFolder = room.curFolder.slice(0, -1);\r\n\t\t\t\tteams = teams.filter(team => !team || team.folder === filterFolder);\r\n\t\t\t} else {\r\n\t\t\t\tfilterFormat = room.curFolder;\r\n\t\t\t\tteams = teams.filter(team => !team || team.format === filterFormat);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<div class=\"folderpane\">\r\n\t\t\t\t{this.renderFolderList()}\r\n\t\t\t</div>\r\n\t\t\t<div class=\"teampane\">\r\n\t\t\t\t{filterFolder ?\r\n\t\t\t\t\t<h2>\r\n\t\t\t\t\t\t<i class=\"fa fa-folder-open\"></i> {filterFolder} {}\r\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"renameFolder\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-pencil\"></i> Rename\r\n\t\t\t\t\t\t</button> {}\r\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"promptDeleteFolder\">\r\n\t\t\t\t\t\t\t<i class=\"fa fa-times\"></i> Remove\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t: filterFolder === '' ?\r\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> Teams not in any folders</h2>\r\n\t\t\t\t: filterFormat ?\r\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> {filterFormat} <small>({teams.length})</small></h2>\r\n\t\t\t\t:\r\n\t\t\t\t\t<h2>All Teams <small>({teams.length})</small></h2>\r\n\t\t\t\t}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam\" class=\"button big\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\r\n\t\t\t\t</p>\r\n\t\t\t\t<ul class=\"teamlist\">\r\n\t\t\t\t\t{teams.map(team => team ? (\r\n\t\t\t\t\t\t<li key={team.key}>\r\n\t\t\t\t\t\t\t<TeamBox team={team} /> {}\r\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/deleteteam ${team.key}`}><i class=\"fa fa-trash\"></i> Delete</button>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<li key=\"undelete\">\r\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/undeleteteam`}><i class=\"fa fa-undo\"></i> Undo delete</button>\r\n\t\t\t\t\t\t</li>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam bottom\" class=\"button\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['teambuilder'] = {\r\n\tModel: TeambuilderRoom,\r\n\tComponent: TeambuilderPanel,\r\n\ttitle: \"Teambuilder\",\r\n};\r\n"],"mappings":"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"}