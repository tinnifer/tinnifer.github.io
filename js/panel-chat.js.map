{"version":3,"file":"panel-chat.js","names":["ChatRoom","_PSRoom","_inheritsLoose","options","_this","call","classType","users","userCount","canConnect","pmTarget","challengeMenuOpen","challengingFormat","challengedFormat","updateTarget","connect","_proto","prototype","connected","PS","send","id","connectWhenLoggedIn","force","startsWith","_this$id$slice$split","slice","split","id1","id2","user","userid","toID","setUsers","title","handleMessage","line","spaceIndex","indexOf","cmd","target","roomid","test","join","leave","openChallenge","cancelChallenge","update","receiveLine","direct","count","usernames","_i2","length","username","addUser","removeUser","noUpdate","renameUser","oldUsername","destroy","PSRoom","ChatTextEntry","_preact$Component","_this2","_len","arguments","args","Array","_key","apply","concat","subscription","textbox","history","historyIndex","style","height","newHeight","Math","min","max","scrollHeight","focusIfNoSelection","e","tagName","selection","window","getSelection","type","elem","base","children","focus","keyDown","handleKey","props","onKey","preventDefault","stopImmediatePropagation","_proto2","componentDidMount","_this3","subscribe","forceUpdate","componentWillUnmount","unsubscribe","submit","onMessage","value","historyPush","historyUp","historyDown","duplicateIndex","lastIndexOf","splice","push","cmdKey","metaKey","ctrlKey","altKey","shiftKey","keyCode","toggleFormatChar","formatChar","setSelectionRange","start","selectionStart","end","selectionEnd","charAt","wrap","substr","nesting","render","preact","h","onClick","left","color","BattleLog","usernameColor","name","room","autofocus","rows","onInput","onKeyDown","resize","width","padding","placeholder","focusPreview","Component","ChatPanel","_PSRoomPanel","_this4","_len2","_key2","text","chatLog","getElementsByClassName","scrollTop","offsetHeight","makeChallenge","format","team","packedTeam","Error","acceptChallenge","_proto3","querySelector","tinyLayout","challengeTo","TeamForm","onSubmit","challengeFrom","PSPanelWrapper","ChatLog","ChatUserList","minimized","PSRoomPanel","_preact$Component2","_this5","_len3","_key3","state","expanded","toggleExpanded","setState","_proto4","_this6","msg","userList","Object","entries","PSUtils","sortBy","_ref","server","getGroup","order","endsWith","map","_ref2","groupSymbol","group","groups","key","includes","_preact$Component3","_this7","_len4","_key4","log","_proto5","_this8","noSubscription","tokens","parseInt","shift","add","setControlsJSX","shouldComponentUpdate","className","top","updateScroll","jsx","controlsElem","undefined","document","createElement","appendChild","battle","scene","role","roomTypes","Model","updateRoomTypes"],"sources":["../src/panel-chat.tsx"],"sourcesContent":["/**\r\n * Chat panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nclass ChatRoom extends PSRoom {\r\n\treadonly classType: 'chat' | 'battle' = 'chat';\r\n\tusers: {[userid: string]: string} = {};\r\n\tuserCount = 0;\r\n\treadonly canConnect = true;\r\n\r\n\t// PM-only properties\r\n\tpmTarget: string | null = null;\r\n\tchallengeMenuOpen = false;\r\n\tchallengingFormat: string | null = null;\r\n\tchallengedFormat: string | null = null;\r\n\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tif (options.pmTarget) this.pmTarget = options.pmTarget as string;\r\n\t\tif (options.challengeMenuOpen) this.challengeMenuOpen = true;\r\n\t\tthis.updateTarget(true);\r\n\t\tthis.connect();\r\n\t}\r\n\tconnect() {\r\n\t\tif (!this.connected) {\r\n\t\t\tif (!this.pmTarget) PS.send(`|/join ${this.id}`);\r\n\t\t\tthis.connected = true;\r\n\t\t\tthis.connectWhenLoggedIn = false;\r\n\t\t}\r\n\t}\r\n\tupdateTarget(force?: boolean) {\r\n\t\tif (this.id.startsWith('pm-')) {\r\n\t\t\tconst [id1, id2] = this.id.slice(3).split('-');\r\n\t\t\tif (id1 === PS.user.userid && toID(this.pmTarget) !== id2) {\r\n\t\t\t\tthis.pmTarget = id2;\r\n\t\t\t} else if (id2 === PS.user.userid && toID(this.pmTarget) !== id1) {\r\n\t\t\t\tthis.pmTarget = id1;\r\n\t\t\t} else if (!force) {\r\n\t\t\t\treturn;\r\n\t\t\t} else {\r\n\t\t\t\tthis.pmTarget = id1;\r\n\t\t\t}\r\n\t\t\tif (!this.userCount) {\r\n\t\t\t\tthis.setUsers(2, [` ${id1}`, ` ${id2}`]);\r\n\t\t\t}\r\n\t\t\tthis.title = `[PM] ${this.pmTarget}`;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @return true to prevent line from being sent to server\r\n\t */\r\n\thandleMessage(line: string) {\r\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\r\n\t\tconst spaceIndex = line.indexOf(' ');\r\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\r\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'j': case 'join': {\r\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\r\n\t\t\tPS.join(roomid);\r\n\t\t\treturn true;\r\n\t\t} case 'part': case 'leave': {\r\n\t\t\tconst roomid = /[^a-z0-9-]/.test(target) ? toID(target) as any as RoomID : target as RoomID;\r\n\t\t\tPS.leave(roomid || this.id);\r\n\t\t\treturn true;\r\n\t\t} case 'chall': case 'challenge': {\r\n\t\t\tif (target) {\r\n\t\t\t\tPS.join(`challenge-${toID(target)}` as RoomID);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis.openChallenge();\r\n\t\t\treturn true;\r\n\t\t} case 'cchall': case 'cancelchallenge': {\r\n\t\t\tthis.cancelChallenge();\r\n\t\t\treturn true;\r\n\t\t} case 'reject': {\r\n\t\t\tthis.challengedFormat = null;\r\n\t\t\tthis.update(null);\r\n\t\t\treturn false;\r\n\t\t}}\r\n\t\treturn super.handleMessage(line);\r\n\t}\r\n\topenChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.challengeMenuOpen = true;\r\n\t\tthis.update(null);\r\n\t}\r\n\tcancelChallenge() {\r\n\t\tif (!this.pmTarget) {\r\n\t\t\tthis.receiveLine([`error`, `Can only be used in a PM.`]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.challengingFormat) {\r\n\t\t\tthis.send('/cancelchallenge', true);\r\n\t\t\tthis.challengingFormat = null;\r\n\t\t\tthis.challengeMenuOpen = true;\r\n\t\t} else {\r\n\t\t\tthis.challengeMenuOpen = false;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\tsend(line: string, direct?: boolean) {\r\n\t\tthis.updateTarget();\r\n\t\tif (!direct && !line) return;\r\n\t\tif (!direct && this.handleMessage(line)) return;\r\n\t\tif (this.pmTarget) {\r\n\t\t\tPS.send(`|/pm ${this.pmTarget}, ${line}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsuper.send(line, true);\r\n\t}\r\n\tsetUsers(count: number, usernames: string[]) {\r\n\t\tthis.userCount = count;\r\n\t\tthis.users = {};\r\n\t\tfor (const username of usernames) {\r\n\t\t\tconst userid = toID(username);\r\n\t\t\tthis.users[userid] = username;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t}\r\n\taddUser(username: string) {\r\n\t\tconst userid = toID(username);\r\n\t\tif (!(userid in this.users)) this.userCount++;\r\n\t\tthis.users[userid] = username;\r\n\t\tthis.update(null);\r\n\t}\r\n\tremoveUser(username: string, noUpdate?: boolean) {\r\n\t\tconst userid = toID(username);\r\n\t\tif (userid in this.users) {\r\n\t\t\tthis.userCount--;\r\n\t\t\tdelete this.users[userid];\r\n\t\t}\r\n\t\tif (!noUpdate) this.update(null);\r\n\t}\r\n\trenameUser(username: string, oldUsername: string) {\r\n\t\tthis.removeUser(oldUsername, true);\r\n\t\tthis.addUser(username);\r\n\t\tthis.update(null);\r\n\t}\r\n\tdestroy() {\r\n\t\tif (this.pmTarget) this.connected = false;\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nclass ChatTextEntry extends preact.Component<{\r\n\troom: PSRoom, onMessage: (msg: string) => void, onKey: (e: KeyboardEvent) => boolean,\r\n\tleft?: number,\r\n}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\ttextbox: HTMLTextAreaElement = null!;\r\n\thistory: string[] = [];\r\n\thistoryIndex = 0;\r\n\tcomponentDidMount() {\r\n\t\tthis.subscription = PS.user.subscribe(() => {\r\n\t\t\tthis.forceUpdate();\r\n\t\t});\r\n\t\tthis.textbox = this.base!.children[0].children[1] as HTMLTextAreaElement;\r\n\t\tif (this.base) this.update();\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) {\r\n\t\t\tthis.subscription.unsubscribe();\r\n\t\t\tthis.subscription = null;\r\n\t\t}\r\n\t}\r\n\tupdate = () => {\r\n\t\tconst textbox = this.textbox;\r\n\t\ttextbox.style.height = `12px`;\r\n\t\tconst newHeight = Math.min(Math.max(textbox.scrollHeight - 2, 16), 600);\r\n\t\ttextbox.style.height = `${newHeight}px`;\r\n\t};\r\n\tfocusIfNoSelection = (e: Event) => {\r\n\t\tif ((e.target as HTMLElement).tagName === 'TEXTAREA') return;\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tconst elem = this.base!.children[0].children[1] as HTMLTextAreaElement;\r\n\t\telem.focus();\r\n\t};\r\n\tsubmit() {\r\n\t\tthis.props.onMessage(this.textbox.value);\r\n\t\tthis.historyPush(this.textbox.value);\r\n\t\tthis.textbox.value = '';\r\n\t\tthis.update();\r\n\t\treturn true;\r\n\t}\r\n\tkeyDown = (e: KeyboardEvent) => {\r\n\t\tif (this.handleKey(e) || this.props.onKey(e)) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\thistoryUp() {\r\n\t\tif (this.historyIndex === 0) return false;\r\n\t\tconst line = this.textbox.value;\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tthis.textbox.value = this.history[--this.historyIndex];\r\n\t\treturn true;\r\n\t}\r\n\thistoryDown() {\r\n\t\tconst line = this.textbox.value;\r\n\t\tif (line !== '') this.history[this.historyIndex] = line;\r\n\t\tif (this.historyIndex === this.history.length) {\r\n\t\t\tif (!line) return false;\r\n\t\t\tthis.textbox.value = '';\r\n\t\t} else if (++this.historyIndex === this.history.length) {\r\n\t\t\tthis.textbox.value = '';\r\n\t\t} else {\r\n\t\t\tthis.textbox.value = this.history[this.historyIndex];\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\thistoryPush(line: string) {\r\n\t\tconst duplicateIndex = this.history.lastIndexOf(line);\r\n\t\tif (duplicateIndex >= 0) this.history.splice(duplicateIndex, 1);\r\n\t\tif (this.history.length > 100) this.history.splice(0, 20);\r\n\t\tthis.history.push(line);\r\n\t\tthis.historyIndex = this.history.length;\r\n\t}\r\n\thandleKey(e: KeyboardEvent) {\r\n\t\tconst cmdKey = ((e.metaKey ? 1 : 0) + (e.ctrlKey ? 1 : 0) === 1) && !e.altKey && !e.shiftKey;\r\n\t\tif (e.keyCode === 13 && !e.shiftKey) { // Enter key\r\n\t\t\treturn this.submit();\r\n\t\t} else if (e.keyCode === 73 && cmdKey) { // Ctrl + I key\r\n\t\t\treturn this.toggleFormatChar('_');\r\n\t\t} else if (e.keyCode === 66 && cmdKey) { // Ctrl + B key\r\n\t\t\treturn this.toggleFormatChar('*');\r\n\t\t} else if (e.keyCode === 192 && cmdKey) { // Ctrl + ` key\r\n\t\t\treturn this.toggleFormatChar('`');\r\n\t\t// } else if (e.keyCode === 9 && !e.ctrlKey) { // Tab key\r\n\t\t// \tconst reverse = !!e.shiftKey; // Shift+Tab reverses direction\r\n\t\t// \treturn this.handleTabComplete(this.$chatbox, reverse);\r\n\t\t} else if (e.keyCode === 38 && !e.shiftKey && !e.altKey) { // Up key\r\n\t\t\treturn this.historyUp();\r\n\t\t} else if (e.keyCode === 40 && !e.shiftKey && !e.altKey) { // Down key\r\n\t\t\treturn this.historyDown();\r\n\t\t// } else if (app.user.lastPM && (textbox.value === '/reply' || textbox.value === '/r' || textbox.value === '/R') && e.keyCode === 32) { // '/reply ' is being written\r\n\t\t// \tvar val = '/pm ' + app.user.lastPM + ', ';\r\n\t\t// \ttextbox.value = val;\r\n\t\t// \ttextbox.setSelectionRange(val.length, val.length);\r\n\t\t// \treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\ttoggleFormatChar(formatChar: string) {\r\n\t\tconst textbox = this.textbox;\r\n\t\tif (!textbox.setSelectionRange) return false;\r\n\r\n\t\tlet value = textbox.value;\r\n\t\tlet start = textbox.selectionStart;\r\n\t\tlet end = textbox.selectionEnd;\r\n\r\n\t\t// make sure start and end aren't midway through the syntax\r\n\t\tif (value.charAt(start) === formatChar && value.charAt(start - 1) === formatChar &&\r\n\t\t\tvalue.charAt(start - 2) !== formatChar) {\r\n\t\t\tstart++;\r\n\t\t}\r\n\t\tif (value.charAt(end) === formatChar && value.charAt(end - 1) === formatChar &&\r\n\t\t\tvalue.charAt(end - 2) !== formatChar) {\r\n\t\t\tend--;\r\n\t\t}\r\n\r\n\t\t// wrap in doubled format char\r\n\t\tconst wrap = formatChar + formatChar;\r\n\t\tvalue = value.substr(0, start) + wrap + value.substr(start, end - start) + wrap + value.substr(end);\r\n\t\tstart += 2;\r\n\t\tend += 2;\r\n\r\n\t\t// prevent nesting\r\n\t\tconst nesting = wrap + wrap;\r\n\t\tif (value.substr(start - 4, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, start - 4) + value.substr(start);\r\n\t\t\tstart -= 4;\r\n\t\t\tend -= 4;\r\n\t\t} else if (start !== end && value.substr(start - 2, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, start - 2) + value.substr(start + 2);\r\n\t\t\tstart -= 2;\r\n\t\t\tend -= 4;\r\n\t\t}\r\n\t\tif (value.substr(end, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, end) + value.substr(end + 4);\r\n\t\t} else if (start !== end && value.substr(end - 2, 4) === nesting) {\r\n\t\t\tvalue = value.substr(0, end - 2) + value.substr(end + 2);\r\n\t\t\tend -= 2;\r\n\t\t}\r\n\r\n\t\ttextbox.value = value;\r\n\t\ttextbox.setSelectionRange(start, end);\r\n\t\treturn true;\r\n\t}\r\n\trender() {\r\n\t\treturn <div\r\n\t\t\tclass=\"chat-log-add hasuserlist\" onClick={this.focusIfNoSelection} style={{left: this.props.left || 0}}\r\n\t\t>\r\n\t\t\t<form class=\"chatbox\">\r\n\t\t\t\t<label style={{color: BattleLog.usernameColor(PS.user.userid)}}>{PS.user.name}:</label>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tclass={this.props.room.connected ? 'textbox' : 'textbox disabled'}\r\n\t\t\t\t\tautofocus\r\n\t\t\t\t\trows={1}\r\n\t\t\t\t\tonInput={this.update}\r\n\t\t\t\t\tonKeyDown={this.keyDown}\r\n\t\t\t\t\tstyle={{resize: 'none', width: '100%', height: '16px', padding: '2px 3px 1px 3px'}}\r\n\t\t\t\t\tplaceholder={PS.focusPreview(this.props.room)}\r\n\t\t\t\t/>\r\n\t\t\t</form>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass ChatPanel extends PSRoomPanel<ChatRoom> {\r\n\tsend = (text: string) => {\r\n\t\tthis.props.room.send(text);\r\n\t};\r\n\tfocus() {\r\n\t\tthis.base!.querySelector('textarea')!.focus();\r\n\t}\r\n\tfocusIfNoSelection = () => {\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tthis.focus();\r\n\t};\r\n\tonKey = (e: KeyboardEvent) => {\r\n\t\tif (e.keyCode === 33) { // Pg Up key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\r\n\t\t\treturn true;\r\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tmakeChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`|/utm ${packedTeam}`);\r\n\t\tPS.send(`|/challenge ${room.pmTarget}, ${format}`);\r\n\t\troom.challengeMenuOpen = false;\r\n\t\troom.challengingFormat = format;\r\n\t\troom.update(null);\r\n\t};\r\n\tacceptChallenge = (e: Event, format: string, team?: Team) => {\r\n\t\tconst room = this.props.room;\r\n\t\tconst packedTeam = team ? team.packedTeam : '';\r\n\t\tif (!room.pmTarget) throw new Error(\"Not a PM room\");\r\n\t\tPS.send(`|/utm ${packedTeam}`);\r\n\t\tthis.props.room.send(`/accept`);\r\n\t\troom.challengedFormat = null;\r\n\t\troom.update(null);\r\n\t};\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst tinyLayout = room.width < 450;\r\n\r\n\t\tconst challengeTo = room.challengingFormat ? <div class=\"challenge\">\r\n\t\t\t<TeamForm format={room.challengingFormat} onSubmit={null}>\r\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : room.challengeMenuOpen ? <div class=\"challenge\">\r\n\t\t\t<TeamForm onSubmit={this.makeChallenge}>\r\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Challenge</strong></button> {}\r\n\t\t\t\t<button name=\"cmd\" value=\"/cancelchallenge\" class=\"button\">Cancel</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\tconst challengeFrom = room.challengedFormat ? <div class=\"challenge\">\r\n\t\t\t<TeamForm format={room.challengedFormat} onSubmit={this.acceptChallenge}>\r\n\t\t\t\t<button type=\"submit\" class=\"button\"><strong>Accept</strong></button> {}\r\n\t\t\t\t<button name=\"cmd\" value=\"/reject\" class=\"button\">Reject</button>\r\n\t\t\t</TeamForm>\r\n\t\t</div> : null;\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<div class=\"tournament-wrapper hasuserlist\"></div>\r\n\t\t\t<ChatLog class=\"chat-log\" room={this.props.room} onClick={this.focusIfNoSelection} left={tinyLayout ? 0 : 146}>\r\n\t\t\t\t{challengeTo || challengeFrom && [challengeTo, challengeFrom]}\r\n\t\t\t</ChatLog>\r\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={tinyLayout ? 0 : 146} />\r\n\t\t\t<ChatUserList room={this.props.room} minimized={tinyLayout} />\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass ChatUserList extends preact.Component<{room: ChatRoom, left?: number, minimized?: boolean}> {\r\n\tsubscription: PSSubscription | null = null;\r\n\tstate = {\r\n\t\texpanded: false,\r\n\t};\r\n\ttoggleExpanded = () => {\r\n\t\tthis.setState({expanded: !this.state.expanded});\r\n\t};\r\n\tcomponentDidMount() {\r\n\t\tthis.subscription = this.props.room.subscribe(msg => {\r\n\t\t\tif (!msg) this.forceUpdate();\r\n\t\t});\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) this.subscription.unsubscribe();\r\n\t}\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\tlet userList = Object.entries(room.users) as [ID, string][];\r\n\t\tPSUtils.sortBy(userList, ([id, name]) => (\r\n\t\t\t[PS.server.getGroup(name.charAt(0)).order, !name.endsWith('@!'), id]\r\n\t\t));\r\n\t\treturn <ul class={'userlist' + (this.props.minimized ? (this.state.expanded ? ' userlist-maximized' : ' userlist-minimized') : '')} style={{left: this.props.left || 0}}>\r\n\t\t\t<li class=\"userlist-count\" onClick={this.toggleExpanded}><small>{room.userCount} users</small></li>\r\n\t\t\t{userList.map(([userid, name]) => {\r\n\t\t\t\tconst groupSymbol = name.charAt(0);\r\n\t\t\t\tconst group = PS.server.groups[groupSymbol] || {type: 'user', order: 0};\r\n\t\t\t\tlet color;\r\n\t\t\t\tif (name.endsWith('@!')) {\r\n\t\t\t\t\tname = name.slice(0, -2);\r\n\t\t\t\t\tcolor = '#888888';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcolor = BattleLog.usernameColor(userid);\r\n\t\t\t\t}\r\n\t\t\t\treturn <li key={userid}><button class=\"userbutton username\" data-name={name}>\r\n\t\t\t\t\t<em class={`group${['leadership', 'staff'].includes(group.type!) ? ' staffgroup' : ''}`}>\r\n\t\t\t\t\t\t{groupSymbol}\r\n\t\t\t\t\t</em>\r\n\t\t\t\t\t{group.type === 'leadership' ?\r\n\t\t\t\t\t\t<strong><em style={{color}}>{name.substr(1)}</em></strong>\r\n\t\t\t\t\t: group.type === 'staff' ?\r\n\t\t\t\t\t\t<strong style={{color}}>{name.substr(1)}</strong>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t\t<span style={{color}}>{name.substr(1)}</span>\r\n\t\t\t\t\t}\r\n\t\t\t\t</button></li>;\r\n\t\t\t})}\r\n\t\t</ul>;\r\n\t}\r\n}\r\n\r\nclass ChatLog extends preact.Component<{\r\n\tclass: string, room: ChatRoom, onClick?: (e: Event) => void, children?: preact.ComponentChildren,\r\n\tleft?: number, top?: number, noSubscription?: boolean;\r\n}> {\r\n\tlog: BattleLog | null = null;\r\n\tsubscription: PSSubscription | null = null;\r\n\tcomponentDidMount() {\r\n\t\tif (!this.props.noSubscription) {\r\n\t\t\tthis.log = new BattleLog(this.base! as HTMLDivElement);\r\n\t\t}\r\n\t\tthis.subscription = this.props.room.subscribe(tokens => {\r\n\t\t\tif (!tokens) return;\r\n\t\t\tswitch (tokens[0]) {\r\n\t\t\tcase 'users':\r\n\t\t\t\tconst usernames = tokens[1].split(',');\r\n\t\t\t\tconst count = parseInt(usernames.shift()!, 10);\r\n\t\t\t\tthis.props.room.setUsers(count, usernames);\r\n\t\t\t\treturn;\r\n\t\t\tcase 'join': case 'j': case 'J':\r\n\t\t\t\tthis.props.room.addUser(tokens[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'leave': case 'l': case 'L':\r\n\t\t\t\tthis.props.room.removeUser(tokens[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'name': case 'n': case 'N':\r\n\t\t\t\tthis.props.room.renameUser(tokens[1], tokens[2]);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!this.props.noSubscription) this.log!.add(tokens);\r\n\t\t});\r\n\t\tthis.setControlsJSX(this.props.children);\r\n\t}\r\n\tcomponentWillUnmount() {\r\n\t\tif (this.subscription) this.subscription.unsubscribe();\r\n\t}\r\n\tshouldComponentUpdate(props: typeof ChatLog.prototype.props) {\r\n\t\tif (props.class !== this.props.class) {\r\n\t\t\tthis.base!.className = props.class;\r\n\t\t}\r\n\t\tif (props.left !== this.props.left) this.base!.style.left = `${props.left || 0}px`;\r\n\t\tif (props.top !== this.props.top) this.base!.style.top = `${props.top || 0}px`;\r\n\t\tthis.setControlsJSX(props.children);\r\n\t\tthis.updateScroll();\r\n\t\treturn false;\r\n\t}\r\n\tsetControlsJSX(jsx: preact.ComponentChildren | undefined) {\r\n\t\tconst children = this.base!.children;\r\n\t\tlet controlsElem = children[children.length - 1] as HTMLDivElement | undefined;\r\n\t\tif (controlsElem && controlsElem.className !== 'controls') controlsElem = undefined;\r\n\t\tif (!jsx) {\r\n\t\t\tif (!controlsElem) return;\r\n\t\t\tpreact.render(null, this.base!, controlsElem);\r\n\t\t\tthis.updateScroll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!controlsElem) {\r\n\t\t\tcontrolsElem = document.createElement('div');\r\n\t\t\tcontrolsElem.className = 'controls';\r\n\t\t\tthis.base!.appendChild(controlsElem);\r\n\t\t}\r\n\t\tpreact.render(<div class=\"controls\">{jsx}</div>, this.base!, controlsElem);\r\n\t\tthis.updateScroll();\r\n\t}\r\n\tupdateScroll() {\r\n\t\tif (this.log) {\r\n\t\t\tthis.log.updateScroll();\r\n\t\t} else if (this.props.room.battle) {\r\n\t\t\tthis.log = (this.props.room.battle as Battle).scene.log;\r\n\t\t\tthis.log.updateScroll();\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\treturn <div class={this.props.class} role=\"log\" onClick={this.props.onClick} style={{\r\n\t\t\tleft: this.props.left || 0, top: this.props.top || 0,\r\n\t\t}}></div>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['chat'] = {\r\n\tModel: ChatRoom,\r\n\tComponent: ChatPanel,\r\n};\r\nPS.updateRoomTypes();\r\n"],"mappings":"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"}