{"version":3,"file":"panel-battle.js","names":["BattlesRoom","_PSRoom","_inheritsLoose","options","_this","call","classType","format","battles","refresh","_proto","prototype","setFormat","update","PS","send","toID","PSRoom","BattlesPanel","_PSRoomPanel","_this2","_len","arguments","length","args","Array","_key","apply","concat","props","room","changeFormat","e","value","target","_proto2","renderBattleLink","battle","id","split","minEloMessage","minElo","preact","h","href","style","p1","p2","render","_this3","PSPanelWrapper","scrollable","name","onClick","Dex","getPokemonIcon","title","FormatDropdown","onChange","map","PSRoomPanel","BattleRoom","_ChatRoom","_this4","_len2","_key2","side","request","choices","_proto3","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","play","pause","turnNum","Number","charAt","turn","isNaN","receiveLine","seekTurn","switchSides","isDone","isEmpty","BattleChoiceBuilder","possibleError","addChoice","toString","ChatRoom","BattleDiv","_preact$Component","_proto4","shouldComponentUpdate","Component","MoveButton","type","tooltip","children","moveData","pp","maxpp","PokemonButton","pokemon","disabled","opacity","hpColorClass","BattleScene","getHPColor","noHPBar","fainted","width","Math","round","hp","maxhp","status","BattlePanel","_PSRoomPanel2","_this5","_len3","_key3","text","focusIfNoSelection","selection","window","getSelection","focus","onKey","keyCode","chatLog","base","getElementsByClassName","scrollTop","offsetHeight","toggleBoostedMove","checkbox","currentTarget","current","mega","checked","ultra","z","max","_proto5","querySelector","componentDidMount","_this6","$elem","$","Battle","$frame","find","$logFrame","scene","tooltips","listen","subscribe","forceUpdate","Infinity","receiveRequest","JSON","parse","instantAdd","join","add","fixRequest","myPokemon","setPerspective","renderControls","renderPlayerControls","atEnd","atQueueEnd","paused","renderMoveControls","dex","pokemonIndex","index","active","currentMoveRequest","maxMoves","canDynamax","moves","i","move","get","maxMoveData","gmaxTooltip","zMoves","zMoveData","renderMoveTargetControls","moveTarget","getChosenMove","moveChoice","stringChoice","userSlot","userSlotCross","farSide","_pokemon","abs","reverse","nearSide","_pokemon2","renderSwitchControls","_choices$currentMoveR","numActive","requestLength","trapped","serverPokemon","cantSwitch","alreadySwitchingIn","includes","renderTeamControls","renderTeamList","team","renderChosenTeam","slot","renderOldChoices","requestType","buf","noCancel","choiceString","choice","parseChoice","choiceType","push","canGigantamax","targetLoc","targetPokemon","moveRequest","alreadyMax","canMegaEvo","alreadyMega","canZMove","alreadyZ","moveName","canShift","gameType","canUltraBurst","ChatLog","left","noSubscription","ChatTextEntry","onMessage","ChatUserList","minimized","role","roomTypes","Model","updateRoomTypes"],"sources":["../src/panel-battle.tsx"],"sourcesContent":["/**\r\n * Battle panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\ntype BattleDesc = {\r\n\tid: RoomID,\r\n\tminElo?: number | string,\r\n\tp1?: string,\r\n\tp2?: string,\r\n\tp3?: string,\r\n\tp4?: string,\r\n};\r\n\r\nclass BattlesRoom extends PSRoom {\r\n\toverride readonly classType = 'battles';\r\n\t/** null means still loading */\r\n\tformat = '';\r\n\tbattles: BattleDesc[] | null = null;\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tthis.refresh();\r\n\t}\r\n\tsetFormat(format: string) {\r\n\t\tif (format === this.format) return this.refresh();\r\n\t\tthis.battles = null;\r\n\t\tthis.format = format;\r\n\t\tthis.update(null);\r\n\t\tthis.refresh();\r\n\t}\r\n\trefresh() {\r\n\t\tPS.send(`|/cmd roomlist ${toID(this.format)}`);\r\n\t}\r\n}\r\n\r\nclass BattlesPanel extends PSRoomPanel<BattlesRoom> {\r\n\trefresh = () => {\r\n\t\tthis.props.room.refresh();\r\n\t};\r\n\tchangeFormat = (e: Event) => {\r\n\t\tconst value = (e.target as HTMLButtonElement).value;\r\n\t\tthis.props.room.setFormat(value);\r\n\t};\r\n\trenderBattleLink(battle: BattleDesc) {\r\n\t\tconst format = battle.id.split('-')[1];\r\n\t\tconst minEloMessage = typeof battle.minElo === 'number' ? `rated ${battle.minElo}` : battle.minElo;\r\n\t\treturn <div><a href={`/${battle.id}`} class=\"blocklink\">\r\n\t\t\t{minEloMessage && <small style=\"float:right\">({minEloMessage})</small>}\r\n\t\t\t<small>[{format}]</small><br />\r\n\t\t\t<em class=\"p1\">{battle.p1}</em> <small class=\"vs\">vs.</small> <em class=\"p2\">{battle.p2}</em>\r\n\t\t</a></div>;\r\n\t}\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\t\treturn <PSPanelWrapper room={room} scrollable><div class=\"pad\">\r\n\t\t\t<button class=\"button\" style=\"float:right;font-size:10pt;margin-top:3px\" name=\"close\"><i class=\"fa fa-times\"></i> Close</button>\r\n\t\t\t<div class=\"roomlist\">\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<button class=\"button\" name=\"refresh\" onClick={this.refresh}><i class=\"fa fa-refresh\"></i> Refresh</button> <span style={Dex.getPokemonIcon('meloetta-pirouette') + ';display:inline-block;vertical-align:middle'} class=\"picon\" title=\"Meloetta is PS's mascot! The Pirouette forme is Fighting-type, and represents our battles.\"></span>\r\n\t\t\t\t</p>\r\n\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<label class=\"label\">Format:</label><FormatDropdown onChange={this.changeFormat} />\r\n\t\t\t\t</p>\r\n\t\t\t\t{/* <label>Minimum Elo: <select name=\"elofilter\"><option value=\"none\">None</option><option value=\"1100\">1100</option><option value=\"1300\">1300</option><option value=\"1500\">1500</option><option value=\"1700\">1700</option><option value=\"1900\">1900</option></select></label>\r\n\r\n\t\t\t\t<form class=\"search\">\r\n\t\t\t\t\t<p>\r\n\t\t\t\t\t\t<input type=\"text\" name=\"prefixsearch\" class=\"textbox\" placeholder=\"Username prefix\"/><button type=\"submit\" class=\"button\">Search</button>\r\n\t\t\t\t\t</p>\r\n\t\t\t\t</form> */}\r\n\t\t\t\t<div class=\"list\">{!room.battles ?\r\n\t\t\t\t\t<p>Loading...</p>\r\n\t\t\t\t: !room.battles.length ?\r\n\t\t\t\t\t<p>No battles are going on</p>\r\n\t\t\t\t:\r\n\t\t\t\t\troom.battles.map(battle => this.renderBattleLink(battle))\r\n\t\t\t\t}</div>\r\n\t\t\t</div>\r\n\t\t</div></PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass BattleRoom extends ChatRoom {\r\n\toverride readonly classType = 'battle';\r\n\tdeclare pmTarget: null;\r\n\tdeclare challengeMenuOpen: false;\r\n\tdeclare challengingFormat: null;\r\n\tdeclare challengedFormat: null;\r\n\r\n\tbattle: Battle = null!;\r\n\t/** null if spectator, otherwise current player's info */\r\n\tside: BattleRequestSideInfo | null = null;\r\n\trequest: BattleRequest | null = null;\r\n\tchoices: BattleChoiceBuilder | null = null;\r\n\r\n\t/**\r\n\t * @return true to prevent line from being sent to server\r\n\t */\r\n\thandleMessage(line: string) {\r\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\r\n\t\tconst spaceIndex = line.indexOf(' ');\r\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\r\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\r\n\t\tswitch (cmd) {\r\n\t\tcase 'play': {\r\n\t\t\tthis.battle.play();\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'pause': {\r\n\t\t\tthis.battle.pause();\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'ffto': case 'fastfowardto': {\r\n\t\t\tlet turnNum = Number(target);\r\n\t\t\tif (target.charAt(0) === '+' || turnNum < 0) {\r\n\t\t\t\tturnNum += this.battle.turn;\r\n\t\t\t\tif (turnNum < 0) turnNum = 0;\r\n\t\t\t} else if (target === 'end') {\r\n\t\t\t\tturnNum = -1;\r\n\t\t\t}\r\n\t\t\tif (isNaN(turnNum)) {\r\n\t\t\t\tthis.receiveLine([`error`, `/ffto - Invalid turn number: ${target}`]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tthis.battle.seekTurn(turnNum);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'switchsides': {\r\n\t\t\tthis.battle.switchSides();\r\n\t\t\treturn true;\r\n\t\t} case 'cancel': case 'undo': {\r\n\t\t\tif (!this.choices || !this.request) {\r\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (this.choices.isDone() || this.choices.isEmpty()) {\r\n\t\t\t\tthis.send('/undo', true);\r\n\t\t\t}\r\n\t\t\tthis.choices = new BattleChoiceBuilder(this.request);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t} case 'move': case 'switch': case 'team': case 'pass': case 'shift': case 'choose': {\r\n\t\t\tif (!this.choices) {\r\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tconst possibleError = this.choices.addChoice(line.slice(cmd === 'choose' ? 8 : 1));\r\n\t\t\tif (possibleError) {\r\n\t\t\t\tthis.receiveLine([`error`, possibleError]);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (this.choices.isDone()) this.send(`/choose ${this.choices.toString()}`, true);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}}\r\n\t\treturn super.handleMessage(line);\r\n\t}\r\n}\r\n\r\nclass BattleDiv extends preact.Component {\r\n\tshouldComponentUpdate() {\r\n\t\treturn false;\r\n\t}\r\n\trender() {\r\n\t\treturn <div class=\"battle\"></div>;\r\n\t}\r\n}\r\n\r\nfunction MoveButton(props: {\r\n\tchildren: string, cmd: string, moveData: {pp: number, maxpp: number}, type: TypeName, tooltip: string,\r\n}) {\r\n\treturn <button name=\"cmd\" value={props.cmd} class={`type-${props.type} has-tooltip`} data-tooltip={props.tooltip}>\r\n\t\t{props.children}<br />\r\n\t\t<small class=\"type\">{props.type}</small> <small class=\"pp\">{props.moveData.pp}/{props.moveData.maxpp}</small>&nbsp;\r\n\t</button>;\r\n}\r\nfunction PokemonButton(props: {\r\n\tpokemon: Pokemon | ServerPokemon | null, cmd: string, noHPBar?: boolean, disabled?: boolean | 'fade', tooltip: string,\r\n}) {\r\n\tconst pokemon = props.pokemon;\r\n\tif (!pokemon) {\r\n\t\treturn <button\r\n\t\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\r\n\t\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\r\n\t\t>\r\n\t\t\t(empty slot)\r\n\t\t</button>;\r\n\t}\r\n\r\n\tlet hpColorClass;\r\n\tswitch (BattleScene.getHPColor(pokemon)) {\r\n\tcase 'y': hpColorClass = 'hpbar hpbar-yellow'; break;\r\n\tcase 'r': hpColorClass = 'hpbar hpbar-red'; break;\r\n\tdefault: hpColorClass = 'hpbar'; break;\r\n\t}\r\n\r\n\treturn <button\r\n\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\r\n\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\r\n\t>\r\n\t\t<span class=\"picon\" style={Dex.getPokemonIcon(pokemon)}></span>\r\n\t\t{pokemon.name}\r\n\t\t{\r\n\t\t\t!props.noHPBar && !pokemon.fainted &&\r\n\t\t\t<span class={hpColorClass}>\r\n\t\t\t\t<span style={{width: Math.round(pokemon.hp * 92 / pokemon.maxhp) || 1}}></span>\r\n\t\t\t</span>\r\n\t\t}\r\n\t\t{!props.noHPBar && pokemon.status && <span class={`status ${pokemon.status}`}></span>}\r\n\t</button>;\r\n}\r\n\r\nclass BattlePanel extends PSRoomPanel<BattleRoom> {\r\n\tsend = (text: string) => {\r\n\t\tthis.props.room.send(text);\r\n\t};\r\n\tfocus() {\r\n\t\tthis.base!.querySelector('textarea')!.focus();\r\n\t}\r\n\tfocusIfNoSelection = () => {\r\n\t\tconst selection = window.getSelection()!;\r\n\t\tif (selection.type === 'Range') return;\r\n\t\tthis.focus();\r\n\t};\r\n\tonKey = (e: KeyboardEvent) => {\r\n\t\tif (e.keyCode === 33) { // Pg Up key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\r\n\t\t\treturn true;\r\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\r\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\r\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\ttoggleBoostedMove = (e: Event) => {\r\n\t\tconst checkbox = e.currentTarget as HTMLInputElement;\r\n\t\tconst choices = this.props.room.choices;\r\n\t\tif (!choices) return; // shouldn't happen\r\n\t\tswitch (checkbox.name) {\r\n\t\tcase 'mega':\r\n\t\t\tchoices.current.mega = checkbox.checked;\r\n\t\t\tbreak;\r\n\t\tcase 'ultra':\r\n\t\t\tchoices.current.ultra = checkbox.checked;\r\n\t\t\tbreak;\r\n\t\tcase 'z':\r\n\t\t\tchoices.current.z = checkbox.checked;\r\n\t\t\tbreak;\r\n\t\tcase 'max':\r\n\t\t\tchoices.current.max = checkbox.checked;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.props.room.update(null);\r\n\t};\r\n\tcomponentDidMount() {\r\n\t\tconst $elem = $(this.base!);\r\n\t\tconst battle = new Battle({\r\n\t\t\t$frame: $elem.find('.battle'),\r\n\t\t\t$logFrame: $elem.find('.battle-log'),\r\n\t\t});\r\n\t\tthis.props.room.battle = battle;\r\n\t\t(battle.scene as BattleScene).tooltips.listen($elem.find('.battle-controls'));\r\n\t\tsuper.componentDidMount();\r\n\t\tbattle.subscribe(() => this.forceUpdate());\r\n\t}\r\n\treceiveLine(args: Args) {\r\n\t\tconst room = this.props.room;\r\n\t\tswitch (args[0]) {\r\n\t\tcase 'initdone':\r\n\t\t\troom.battle.seekTurn(Infinity);\r\n\t\t\treturn;\r\n\t\tcase 'request':\r\n\t\t\tthis.receiveRequest(args[1] ? JSON.parse(args[1]) : null);\r\n\t\t\treturn;\r\n\t\tcase 'win': case 'tie':\r\n\t\t\tthis.receiveRequest(null);\r\n\t\t\tbreak;\r\n\t\tcase 'c': case 'c:': case 'chat': case 'chatmsg': case 'inactive':\r\n\t\t\troom.battle.instantAdd('|' + args.join('|'));\r\n\t\t\treturn;\r\n\t\tcase 'error':\r\n\t\t\tif (args[1].startsWith('[Invalid choice]') && room.request) {\r\n\t\t\t\troom.choices = new BattleChoiceBuilder(room.request);\r\n\t\t\t\troom.update(null);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\troom.battle.add('|' + args.join('|'));\r\n\t}\r\n\treceiveRequest(request: BattleRequest | null) {\r\n\t\tconst room = this.props.room;\r\n\t\tif (!request) {\r\n\t\t\troom.request = null;\r\n\t\t\troom.choices = null;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tBattleChoiceBuilder.fixRequest(request, room.battle);\r\n\r\n\t\tif (request.side) {\r\n\t\t\troom.battle.myPokemon = request.side.pokemon;\r\n\t\t\troom.battle.setPerspective(request.side.id);\r\n\t\t\troom.side = request.side;\r\n\t\t}\r\n\r\n\t\troom.request = request;\r\n\t\troom.choices = new BattleChoiceBuilder(request);\r\n\t\troom.update(null);\r\n\t}\r\n\trenderControls() {\r\n\t\tconst room = this.props.room;\r\n\t\tif (!room.battle) return null;\r\n\t\tif (room.side) {\r\n\t\t\treturn this.renderPlayerControls();\r\n\t\t}\r\n\t\tconst atEnd = room.battle.atQueueEnd;\r\n\t\treturn <div class=\"controls\">\r\n\t\t\t<p>\r\n\t\t\t\t{atEnd ?\r\n\t\t\t\t\t<button class=\"button disabled\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\r\n\t\t\t\t: room.battle.paused ?\r\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\r\n\t\t\t\t:\r\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/pause\"><i class=\"fa fa-pause\"></i><br />Pause</button>\r\n\t\t\t\t} {}\r\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto -1\"><i class=\"fa fa-step-backward\"></i><br />Last turn</button>\r\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto +1\"><i class=\"fa fa-step-forward\"></i><br />Skip turn</button> {}\r\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto 0\"><i class=\"fa fa-undo\"></i><br />First turn</button>\r\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto end\"><i class=\"fa fa-fast-forward\"></i><br />Skip to end</button>\r\n\t\t\t</p>\r\n\t\t\t<p>\r\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/switchsides\"><i class=\"fa fa-random\"></i> Switch sides</button>\r\n\t\t\t</p>\r\n\t\t</div>;\r\n\t}\r\n\trenderMoveControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\r\n\t\tconst dex = this.props.room.battle.dex;\r\n\t\tconst pokemonIndex = choices.index();\r\n\t\tconst active = choices.currentMoveRequest();\r\n\t\tif (!active) return <div class=\"message-error\">Invalid pokemon</div>;\r\n\r\n\t\tif (choices.current.max || (active.maxMoves && !active.canDynamax)) {\r\n\t\t\tif (!active.maxMoves) {\r\n\t\t\t\treturn <div class=\"message-error\">Maxed with no max moves</div>;\r\n\t\t\t}\r\n\t\t\treturn active.moves.map((moveData, i) => {\r\n\t\t\t\tconst move = dex.moves.get(moveData.name);\r\n\t\t\t\tconst maxMoveData = active.maxMoves![i];\r\n\t\t\t\tconst gmaxTooltip = maxMoveData.id.startsWith('gmax') ? `|${maxMoveData.id}` : ``;\r\n\t\t\t\tconst tooltip = `maxmove|${moveData.name}|${pokemonIndex}${gmaxTooltip}`;\r\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} max`} type={move.type} tooltip={tooltip} moveData={moveData}>\r\n\t\t\t\t\t{maxMoveData.name}\r\n\t\t\t\t</MoveButton>;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (choices.current.z) {\r\n\t\t\tif (!active.zMoves) {\r\n\t\t\t\treturn <div class=\"message-error\">No Z moves</div>;\r\n\t\t\t}\r\n\t\t\treturn active.moves.map((moveData, i) => {\r\n\t\t\t\tconst move = dex.moves.get(moveData.name);\r\n\t\t\t\tconst zMoveData = active.zMoves![i];\r\n\t\t\t\tif (!zMoveData) {\r\n\t\t\t\t\treturn <button disabled>&nbsp;</button>;\r\n\t\t\t\t}\r\n\t\t\t\tconst tooltip = `zmove|${moveData.name}|${pokemonIndex}`;\r\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} zmove`} type={move.type} tooltip={tooltip} moveData={{pp: 1, maxpp: 1}}>\r\n\t\t\t\t\t{zMoveData.name}\r\n\t\t\t\t</MoveButton>;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn active.moves.map((moveData, i) => {\r\n\t\t\tconst move = dex.moves.get(moveData.name);\r\n\t\t\tconst tooltip = `move|${moveData.name}|${pokemonIndex}`;\r\n\t\t\treturn <MoveButton cmd={`/move ${i + 1}`} type={move.type} tooltip={tooltip} moveData={moveData}>\r\n\t\t\t\t{move.name}\r\n\t\t\t</MoveButton>;\r\n\t\t});\r\n\t}\r\n\trenderMoveTargetControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\r\n\t\tconst battle = this.props.room.battle;\r\n\t\tconst moveTarget = choices.getChosenMove(choices.current, choices.index()).target;\r\n\t\tconst moveChoice = choices.stringChoice(choices.current);\r\n\r\n\t\tconst userSlot = choices.index();\r\n\t\tconst userSlotCross = battle.farSide.active.length - 1 - userSlot;\r\n\r\n\t\treturn [\r\n\t\t\tbattle.farSide.active.map((pokemon, i) => {\r\n\t\t\t\tlet disabled = false;\r\n\t\t\t\tif (moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\r\n\t\t\t\t\tdisabled = true;\r\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentFoe') {\r\n\t\t\t\t\tif (Math.abs(userSlotCross - i) > 1) disabled = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\r\n\t\t\t\treturn <PokemonButton\r\n\t\t\t\t\tpokemon={pokemon}\r\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} +${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|1|${i}`}\r\n\t\t\t\t/>;\r\n\t\t\t}).reverse(),\r\n\t\t\t<div style=\"clear: left\"></div>,\r\n\t\t\tbattle.nearSide.active.map((pokemon, i) => {\r\n\t\t\t\tlet disabled = false;\r\n\t\t\t\tif (moveTarget === 'adjacentFoe') {\r\n\t\t\t\t\tdisabled = true;\r\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\r\n\t\t\t\t\tif (Math.abs(userSlot - i) > 1) disabled = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (moveTarget !== 'adjacentAllyOrSelf' && userSlot === i) disabled = true;\r\n\r\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\r\n\t\t\t\treturn <PokemonButton\r\n\t\t\t\t\tpokemon={pokemon}\r\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} -${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|0|${i}`}\r\n\t\t\t\t/>;\r\n\t\t\t}),\r\n\t\t];\r\n\t}\r\n\trenderSwitchControls(request: BattleMoveRequest | BattleSwitchRequest, choices: BattleChoiceBuilder) {\r\n\t\tconst numActive = choices.requestLength();\r\n\r\n\t\tconst trapped = choices.currentMoveRequest()?.trapped;\r\n\r\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\r\n\t\t\tconst cantSwitch = trapped || i < numActive || choices.alreadySwitchingIn.includes(i + 1) || serverPokemon.fainted;\r\n\t\t\treturn <PokemonButton\r\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} disabled={cantSwitch} tooltip={`switchpokemon|${i}`}\r\n\t\t\t/>;\r\n\t\t});\r\n\t}\r\n\trenderTeamControls(request: | BattleTeamRequest, choices: BattleChoiceBuilder) {\r\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\r\n\t\t\tconst cantSwitch = choices.alreadySwitchingIn.includes(i + 1);\r\n\t\t\treturn <PokemonButton\r\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} noHPBar disabled={cantSwitch && 'fade'} tooltip={`switchpokemon|${i}`}\r\n\t\t\t/>;\r\n\t\t});\r\n\t}\r\n\trenderTeamList() {\r\n\t\tconst team = this.props.room.battle.myPokemon;\r\n\t\tif (!team) return;\r\n\t\treturn <div class=\"switchcontrols\">\r\n\t\t\t<h3 class=\"switchselect\">Team</h3>\r\n\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t{team.map((serverPokemon, i) => {\r\n\t\t\t\t\treturn <PokemonButton\r\n\t\t\t\t\t\tpokemon={serverPokemon} cmd={``} noHPBar disabled={true} tooltip={`switchpokemon|${i}`}\r\n\t\t\t\t\t/>;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\trenderChosenTeam(request: BattleTeamRequest, choices: BattleChoiceBuilder) {\r\n\t\treturn choices.alreadySwitchingIn.map(slot => {\r\n\t\t\tconst serverPokemon = request.side.pokemon[slot - 1];\r\n\t\t\treturn <PokemonButton\r\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${slot}`} disabled tooltip={`switchpokemon|${slot - 1}`}\r\n\t\t\t/>;\r\n\t\t});\r\n\t}\r\n\trenderOldChoices(request: BattleRequest, choices: BattleChoiceBuilder) {\r\n\t\tif (!choices) return null; // should not happen\r\n\t\tif (request.requestType !== 'move' && request.requestType !== 'switch') return;\r\n\t\tif (choices.isEmpty()) return null;\r\n\r\n\t\tlet buf: preact.ComponentChild[] = [\r\n\t\t\t<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>, ' ',\r\n\t\t];\r\n\t\tif (choices.isDone() && request.noCancel) {\r\n\t\t\tbuf = ['Waiting for opponent...'];\r\n\t\t}\r\n\r\n\t\tconst battle = this.props.room.battle;\r\n\t\tfor (let i = 0; i < choices.choices.length; i++) {\r\n\t\t\tconst choiceString = choices.choices[i];\r\n\t\t\tconst choice = choices.parseChoice(choiceString);\r\n\t\t\tif (!choice) continue;\r\n\t\t\tconst pokemon = request.side.pokemon[i];\r\n\t\t\tconst active = request.requestType === 'move' ? request.active[i] : null;\r\n\t\t\tif (choice.choiceType === 'move') {\r\n\t\t\t\tbuf.push(`${pokemon.name} will `);\r\n\t\t\t\tif (choice.mega) buf.push(`Mega Evolve and `);\r\n\t\t\t\tif (choice.ultra) buf.push(`Ultra Burst and `);\r\n\t\t\t\tif (choice.max && active?.canDynamax) buf.push(active?.canGigantamax ? `Gigantamax and ` : `Dynamax and `);\r\n\t\t\t\tbuf.push(`use `, <strong>{choices.getChosenMove(choice, i).name}</strong>);\r\n\t\t\t\tif (choice.targetLoc > 0) {\r\n\t\t\t\t\tconst target = battle.farSide.active[choice.targetLoc - 1];\r\n\t\t\t\t\tif (!target) {\r\n\t\t\t\t\t\tbuf.push(` at slot ${choice.targetLoc}`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbuf.push(` at ${target.name}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (choice.targetLoc < 0) {\r\n\t\t\t\t\tconst target = battle.nearSide.active[-choice.targetLoc - 1];\r\n\t\t\t\t\tif (!target) {\r\n\t\t\t\t\t\tbuf.push(` at ally slot ${choice.targetLoc}`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbuf.push(` at ally ${target.name}`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (choice.choiceType === 'switch') {\r\n\t\t\t\tconst target = request.side.pokemon[choice.targetPokemon - 1];\r\n\t\t\t\tbuf.push(`${pokemon.name} will switch to `, <strong>{target.name}</strong>);\r\n\t\t\t} else if (choice.choiceType === 'shift') {\r\n\t\t\t\tbuf.push(`${pokemon.name} will `, <strong>shift</strong>, ` to the center`);\r\n\t\t\t}\r\n\t\t\tbuf.push(<br />);\r\n\t\t}\r\n\t\treturn buf;\r\n\t}\r\n\trenderPlayerControls() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst request = room.request;\r\n\t\tlet choices = room.choices;\r\n\t\tif (!request) return 'Error: Missing request';\r\n\t\tif (!choices) return 'Error: Missing BattleChoiceBuilder';\r\n\t\tif (choices.request !== request) {\r\n\t\t\tchoices = new BattleChoiceBuilder(request);\r\n\t\t\troom.choices = choices;\r\n\t\t}\r\n\r\n\t\tif (choices.isDone()) {\r\n\t\t\treturn <div class=\"controls\">\r\n\t\t\t\t<div class=\"whatdo\">\r\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\r\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"pad\">\r\n\t\t\t\t\t{request.noCancel ? null : <button name=\"cmd\" value=\"/cancel\" class=\"button\">Cancel</button>}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.renderTeamList()}\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\tif (request.side) room.battle.myPokemon = request.side.pokemon;\r\n\t\tswitch (request.requestType) {\r\n\t\tcase 'move': {\r\n\t\t\tconst index = choices.index();\r\n\t\t\tconst pokemon = request.side.pokemon[index];\r\n\t\t\tconst moveRequest = choices.currentMoveRequest()!;\r\n\r\n\t\t\tconst canDynamax = moveRequest.canDynamax && !choices.alreadyMax;\r\n\t\t\tconst canMegaEvo = moveRequest.canMegaEvo && !choices.alreadyMega;\r\n\t\t\tconst canZMove = moveRequest.zMoves && !choices.alreadyZ;\r\n\r\n\t\t\tif (choices.current.move) {\r\n\t\t\t\tconst moveName = choices.getChosenMove(choices.current, choices.index()).name;\r\n\t\t\t\treturn <div class=\"controls\">\r\n\t\t\t\t\t<div class=\"whatdo\">\r\n\t\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\r\n\t\t\t\t\t\t{this.renderOldChoices(request, choices)}\r\n\t\t\t\t\t\t{pokemon.name} should use <strong>{moveName}</strong> at where? {}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"switchcontrols\">\r\n\t\t\t\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t\t\t\t{this.renderMoveTargetControls(request, choices)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\r\n\t\t\tconst canShift = room.battle.gameType === 'triples' && index !== 1;\r\n\r\n\t\t\treturn <div class=\"controls\">\r\n\t\t\t\t<div class=\"whatdo\">\r\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\r\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\r\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"movecontrols\">\r\n\t\t\t\t\t<h3 class=\"moveselect\">Attack</h3>\r\n\t\t\t\t\t<div class=\"movemenu\">\r\n\t\t\t\t\t\t{this.renderMoveControls(request, choices)}\r\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\r\n\t\t\t\t\t\t{canDynamax && <label class={`megaevo${choices.current.max ? ' cur' : ''}`}>\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"max\" checked={choices.current.max} onChange={this.toggleBoostedMove} /> {}\r\n\t\t\t\t\t\t\t{moveRequest.canGigantamax ? 'Gigantamax' : 'Dynamax'}\r\n\t\t\t\t\t\t</label>}\r\n\t\t\t\t\t\t{canMegaEvo && <label class={`megaevo${choices.current.mega ? ' cur' : ''}`}>\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"mega\" checked={choices.current.mega} onChange={this.toggleBoostedMove} /> {}\r\n\t\t\t\t\t\t\tMega Evolution\r\n\t\t\t\t\t\t</label>}\r\n\t\t\t\t\t\t{moveRequest.canUltraBurst && <label class={`megaevo${choices.current.ultra ? ' cur' : ''}`}>\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"ultra\" checked={choices.current.ultra} onChange={this.toggleBoostedMove} /> {}\r\n\t\t\t\t\t\t\tUltra Burst\r\n\t\t\t\t\t\t</label>}\r\n\t\t\t\t\t\t{canZMove && <label class={`megaevo${choices.current.z ? ' cur' : ''}`}>\r\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"z\" checked={choices.current.z} onChange={this.toggleBoostedMove} /> {}\r\n\t\t\t\t\t\t\tZ-Power\r\n\t\t\t\t\t\t</label>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"switchcontrols\">\r\n\t\t\t\t\t{canShift && [\r\n\t\t\t\t\t\t<h3 class=\"shiftselect\">Shift</h3>,\r\n\t\t\t\t\t\t<button name=\"cmd\" value=\"/shift\">Move to center</button>,\r\n\t\t\t\t\t]}\r\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\r\n\t\t\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t} case 'switch': {\r\n\t\t\tconst pokemon = request.side.pokemon[choices.index()];\r\n\t\t\treturn <div class=\"controls\">\r\n\t\t\t\t<div class=\"whatdo\">\r\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\r\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\r\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"switchcontrols\">\r\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\r\n\t\t\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t} case 'team': {\r\n\t\t\treturn <div class=\"controls\">\r\n\t\t\t\t<div class=\"whatdo\">\r\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\r\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 ?\r\n\t\t\t\t\t\t[<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>,\r\n\t\t\t\t\t\t\" What about the rest of your team? \"]\r\n\t\t\t\t\t:\r\n\t\t\t\t\t\t\"How will you start the battle? \"\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"switchcontrols\">\r\n\t\t\t\t\t<h3 class=\"switchselect\">Choose {choices.alreadySwitchingIn.length <= 0 ? `lead` : `slot ${choices.alreadySwitchingIn.length + 1}`}</h3>\r\n\t\t\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t\t\t{this.renderTeamControls(request, choices)}\r\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"switchcontrols\">\r\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 && <h3 class=\"switchselect\">Team so far</h3>}\r\n\t\t\t\t\t<div class=\"switchmenu\">\r\n\t\t\t\t\t\t{this.renderChosenTeam(request, choices)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}}\r\n\t}\r\n\trender() {\r\n\t\tconst room = this.props.room;\r\n\r\n\t\treturn <PSPanelWrapper room={room}>\r\n\t\t\t<BattleDiv></BattleDiv>\r\n\t\t\t<ChatLog class=\"battle-log hasuserlist\" room={this.props.room} onClick={this.focusIfNoSelection} left={640} noSubscription>\r\n\t\t\t\t{}\r\n\t\t\t</ChatLog>\r\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={640} />\r\n\t\t\t<ChatUserList room={this.props.room} left={640} minimized />\r\n\t\t\t<div class=\"battle-controls\" role=\"complementary\" aria-label=\"Battle Controls\" style=\"top: 370px;\">\r\n\t\t\t\t{this.renderControls()}\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nPS.roomTypes['battle'] = {\r\n\tModel: BattleRoom,\r\n\tComponent: BattlePanel,\r\n};\r\nPS.roomTypes['battles'] = {\r\n\tModel: BattlesRoom,\r\n\tComponent: BattlesPanel,\r\n};\r\nPS.updateRoomTypes();\r\n"],"mappings":"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"}