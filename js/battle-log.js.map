{"version":3,"file":"battle-log.js","names":["BattleLog","elem","scene","innerElem","_this","preemptElem","atBottom","skippedLines","className","battleParser","joinLeave","lastRename","perspective","onScroll","distanceFromBottom","scrollHeight","scrollTop","clientHeight","setAttribute","innerHTML","document","createElement","appendChild","BattleTextParser","onscroll","_proto","prototype","reset","destroy","addSeekEarlierButton","_this2","el","button","getElementsByTagName","addEventListener","e","_this2$scene","preventDefault","battle","seekTurn","turn","addNode","add","args","kwArgs","preempt","_this$scene","_this$scene2","_window$app","_window$app$ignore","_window$app2","_window$app2$rooms","_this$scene3","silent","seeking","stepQueue","length","Infinity","currentStep","divClass","divHTML","noNotify","includes","name","message","rank","charAt","ignoreSpects","ignoreOpponent","toUserid","app","user","get","window","ignore","isHighlighted","rooms","roomid","getHighlight","_this$parseChatMessag","parseChatMessage","notifyTitle","notifyOnce","parseNameParts","group","formattedUser","isJoin","joins","leaves","element","splice","indexOf","push","buf","textList","escapeHTML","toID","to","from","sanitizeHTML","changeUhtml","replace","parseMessage","addDiv","unlinkChatFrom","lineCount","parseInt","hideChatFrom","title","body","addBattleMessage","wait","ruleArgs","split","h2elem","turnMessage","parseArgs","trim","startsWith","endsWith","Error","slice","curLineSection","addSpacer","line","join","apply","parseLogMessage","list","listNoDuplicates","_i2","_list2","i","messages","map","filter","sceneMessage","arguments","undefined","node","updateScroll","prependDiv","childNodes","insertBefore","id","htmlSrc","forceAdd","classContains","elements","_i4","_ref2","_i6","_ref4","_i8","_i10","parentElement","removeChild","userid","showRevealButton","classStart","nodes","_i12","_ref6","_i14","_ref8","_i16","_nodes2","style","display","value","lastNode","createTextNode","unlinkNodeList","nodeList","_i18","_ref10","linkList","linkNode","parent","_i20","_ref12","childNode","innerNodeList","preemptNodeList","preemptCatchup","firstChild","escapeFormat","formatid","atIndex","BattleFormats","NonBattleGames","str","jsEscapeToo","unescapeHTML","hashColor","usernameColor","colorCache","hash","Config","customcolors","MD5","H","substr","S","L","Math","floor","_this$HSLToRGB","HSLToRGB","R","G","B","lum","HLmod","Hdist","min","abs","_this$HSLToRGB2","r","g","b","toHex","x","hex","round","toString","C","X","m","R1","G1","B1","prefs","_window$Storage","Storage","PS","timestamp","_BattleLog$prefs","_window$app3","_window$app3$user","_window$PS","showMe","hideme","test","colorStyle","clickableName","hlClass","isMine","mineClass","cmd","target","spaceIndex","parsedMessage","toRoomid","formatText","parts","isTrusted","options","hidelinks","hidespoiler","hidegreentext","initSanitizeHTML","_this3","tagPolicy","Object","assign","html4","ELEMENTS","marquee","blink","psicon","eflags","username","spotify","youtube","twitch","ATTRIBS","tagName","attribs","getAttrib","key","setAttrib","deleteAttrib","dataUri","targetReplace","src","location","protocol","_exec","channelId","exec","height","width","hostname","color","_exec2","songId","_exec3","_exec4","innerWidth","videoId","time","players","idx","initYoutubePlayer","iconType","iconValue","_attribs$slice","Dex","getPokemonIcon","getItemIcon","getTypeIcon","getCategoryIcon","html","sanitizeAttribs","urlData","scheme_","localizeTime","full","date","timezone","_Intl","parsedTime","Date","toUpperCase","getTime","formattedTime","Intl","DateTimeFormat","month","day","hour","minute","format","toLocaleString","input","match","attrs","escapedUsername","sanitized","sanitizeWithPolicy","_this4","loadPlayer","$","player","YT","Player","events","onStateChange","event","data","PlayerState","PLAYING","_i22","_BattleLog$players2","curPlayer","pauseVideo","ensureYoutube","then","setTimeout","ytLoading","Promise","resolve","type","async","onload","loopCheck","_window$YT","createReplayFile","room","replayid","server","registered","fragment","tier","p1","p2","routes","users","log","client","createReplayFileHref","encodeURIComponent","btoa","unescape","interstice","whitelist","patterns","entry","RegExp","isWhitelisted","uri","_i24","pattern","getURI","root"],"sources":["../src/battle-log.ts"],"sourcesContent":["/**\r\n * Battle log\r\n *\r\n * An exercise in minimalism! This is a dependency of the client, which\r\n * requires IE9+ and uses Preact, and the replay player, which requires\r\n * IE7+ and uses jQuery. Therefore, this has to be compatible with IE7+\r\n * and use the DOM directly!\r\n *\r\n * Special thanks to PPK for QuirksMode.org, one of the few resources\r\n * available for how to do web development in these conditions.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\nimport type {BattleScene} from './battle-animations';\r\n\r\n// Caja\r\ndeclare const html4: any;\r\ndeclare const html: any;\r\n\r\n// defined in battle-log-misc\r\ndeclare function MD5(input: string): string;\r\ndeclare function formatText(input: string, isTrusted?: boolean): string;\r\n\r\nexport class BattleLog {\r\n\telem: HTMLDivElement;\r\n\tinnerElem: HTMLDivElement;\r\n\tscene: BattleScene | null = null;\r\n\tpreemptElem: HTMLDivElement = null!;\r\n\tatBottom = true;\r\n\tskippedLines = false;\r\n\tclassName: string;\r\n\tbattleParser: BattleTextParser | null = null;\r\n\tjoinLeave: {\r\n\t\tjoins: string[],\r\n\t\tleaves: string[],\r\n\t\telement: HTMLDivElement,\r\n\t} | null = null;\r\n\tlastRename: {\r\n\t\tfrom: string,\r\n\t\tto: string,\r\n\t\telement: HTMLDivElement,\r\n\t} | null = null;\r\n\t/**\r\n\t * * -1 = spectator: \"Red sent out Pikachu!\" \"Blue's Eevee used Tackle!\"\r\n\t * * 0 = player 1: \"Go! Pikachu!\" \"The opposing Eevee used Tackle!\"\r\n\t * * 1 = player 2: \"Red sent out Pikachu!\" \"Eevee used Tackle!\"\r\n\t */\r\n\tperspective: -1 | 0 | 1 = -1;\r\n\tconstructor(elem: HTMLDivElement, scene?: BattleScene | null, innerElem?: HTMLDivElement) {\r\n\t\tthis.elem = elem;\r\n\r\n\t\tif (!innerElem) {\r\n\t\t\telem.setAttribute('role', 'log');\r\n\t\t\telem.innerHTML = '';\r\n\t\t\tinnerElem = document.createElement('div');\r\n\t\t\tinnerElem.className = 'inner message-log';\r\n\t\t\telem.appendChild(innerElem);\r\n\t\t}\r\n\t\tthis.innerElem = innerElem;\r\n\r\n\t\tif (scene) {\r\n\t\t\tthis.scene = scene;\r\n\t\t\tconst preemptElem = document.createElement('div');\r\n\t\t\tpreemptElem.className = 'inner-preempt message-log';\r\n\t\t\telem.appendChild(preemptElem);\r\n\t\t\tthis.preemptElem = preemptElem;\r\n\t\t\tthis.battleParser = new BattleTextParser();\r\n\t\t}\r\n\r\n\t\tthis.className = elem.className;\r\n\t\telem.onscroll = this.onScroll;\r\n\t}\r\n\tonScroll = () => {\r\n\t\tconst distanceFromBottom = this.elem.scrollHeight - this.elem.scrollTop - this.elem.clientHeight;\r\n\t\tthis.atBottom = (distanceFromBottom < 30);\r\n\t};\r\n\treset() {\r\n\t\tthis.innerElem.innerHTML = '';\r\n\t\tthis.atBottom = true;\r\n\t\tthis.skippedLines = false;\r\n\t}\r\n\tdestroy() {\r\n\t\tthis.elem.onscroll = null;\r\n\t}\r\n\taddSeekEarlierButton() {\r\n\t\tif (this.skippedLines) return;\r\n\t\tthis.skippedLines = true;\r\n\t\tconst el = document.createElement('div');\r\n\t\tel.className = 'chat';\r\n\t\tel.innerHTML = '<button class=\"button earlier-button\"><i class=\"fa fa-caret-up\"></i><br />Earlier messages</button>';\r\n\t\tconst button = el.getElementsByTagName('button')[0];\r\n\t\tbutton?.addEventListener?.('click', e => {\r\n\t\t\te.preventDefault();\r\n\t\t\tthis.scene?.battle.seekTurn(this.scene.battle.turn - 100);\r\n\t\t});\r\n\t\tthis.addNode(el);\r\n\t}\r\n\tadd(args: Args, kwArgs?: KWArgs, preempt?: boolean) {\r\n\t\tif (kwArgs?.silent) return;\r\n\t\tif (this.scene?.battle.seeking) {\r\n\t\t\tconst battle = this.scene.battle;\r\n\t\t\tif (battle.stepQueue.length > 2000) {\r\n\t\t\t\t// adding elements gets slower and slower the more there are\r\n\t\t\t\t// (so showing 100 turns takes around 2 seconds, and 1000 turns takes around a minute)\r\n\t\t\t\t// capping at 100 turns makes everything _reasonably_ snappy\r\n\t\t\t\tif (\r\n\t\t\t\t\tbattle.seeking === Infinity ?\r\n\t\t\t\t\t\tbattle.currentStep < battle.stepQueue.length - 2000 :\r\n\t\t\t\t\t\tbattle.turn < battle.seeking! - 100\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.addSeekEarlierButton();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet divClass = 'chat';\r\n\t\tlet divHTML = '';\r\n\t\tlet noNotify: boolean | undefined;\r\n\t\tif (!['join', 'j', 'leave', 'l'].includes(args[0])) this.joinLeave = null;\r\n\t\tif (!['name', 'n'].includes(args[0])) this.lastRename = null;\r\n\t\tswitch (args[0]) {\r\n\t\tcase 'chat': case 'c': case 'c:':\r\n\t\t\tlet battle = this.scene?.battle;\r\n\t\t\tlet name;\r\n\t\t\tlet message;\r\n\t\t\tif (args[0] === 'c:') {\r\n\t\t\t\tname = args[2];\r\n\t\t\t\tmessage = args[3];\r\n\t\t\t} else {\r\n\t\t\t\tname = args[1];\r\n\t\t\t\tmessage = args[2];\r\n\t\t\t}\r\n\t\t\tlet rank = name.charAt(0);\r\n\t\t\tif (battle?.ignoreSpects && ' +'.includes(rank)) return;\r\n\t\t\tif (battle?.ignoreOpponent) {\r\n\t\t\t\tif ('\\u2605\\u2606'.includes(rank) && toUserid(name) !== app.user.get('userid')) return;\r\n\t\t\t}\r\n\t\t\tif (window.app?.ignore?.[toUserid(name)] && ' +\\u2605\\u2606'.includes(rank)) return;\r\n\t\t\tlet isHighlighted = window.app?.rooms?.[battle!.roomid].getHighlight(message);\r\n\t\t\t[divClass, divHTML, noNotify] = this.parseChatMessage(message, name, '', isHighlighted);\r\n\t\t\tif (!noNotify && isHighlighted) {\r\n\t\t\t\tlet notifyTitle = \"Mentioned by \" + name + \" in \" + battle!.roomid;\r\n\t\t\t\tapp.rooms[battle!.roomid].notifyOnce(notifyTitle, \"\\\"\" + message + \"\\\"\", 'highlight');\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'join': case 'j': case 'leave': case 'l': {\r\n\t\t\tconst user = BattleTextParser.parseNameParts(args[1]);\r\n\t\t\tif (battle?.ignoreSpects && ' +'.includes(user.group)) return;\r\n\t\t\tconst formattedUser = user.group + user.name;\r\n\t\t\tconst isJoin = (args[0].charAt(0) === 'j');\r\n\t\t\tif (!this.joinLeave) {\r\n\t\t\t\tthis.joinLeave = {\r\n\t\t\t\t\tjoins: [],\r\n\t\t\t\t\tleaves: [],\r\n\t\t\t\t\telement: document.createElement('div'),\r\n\t\t\t\t};\r\n\t\t\t\tthis.joinLeave.element.className = 'chat';\r\n\t\t\t}\r\n\r\n\t\t\tif (isJoin && this.joinLeave.leaves.includes(formattedUser)) {\r\n\t\t\t\tthis.joinLeave.leaves.splice(this.joinLeave.leaves.indexOf(formattedUser), 1);\r\n\t\t\t} else {\r\n\t\t\t\tthis.joinLeave[isJoin ? \"joins\" : \"leaves\"].push(formattedUser);\r\n\t\t\t}\r\n\r\n\t\t\tlet buf = '';\r\n\t\t\tif (this.joinLeave.joins.length) {\r\n\t\t\t\tbuf += `${this.textList(this.joinLeave.joins)} joined`;\r\n\t\t\t}\r\n\t\t\tif (this.joinLeave.leaves.length) {\r\n\t\t\t\tif (this.joinLeave.joins.length) buf += `; `;\r\n\t\t\t\tbuf += `${this.textList(this.joinLeave.leaves)} left`;\r\n\t\t\t}\r\n\t\t\tthis.joinLeave.element.innerHTML = `<small>${BattleLog.escapeHTML(buf)}</small>`;\r\n\t\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(this.joinLeave.element);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcase 'name': case 'n': {\r\n\t\t\tconst user = BattleTextParser.parseNameParts(args[1]);\r\n\t\t\tif (toID(args[2]) === toID(user.name)) return;\r\n\t\t\tif (!this.lastRename || toID(this.lastRename.to) !== toID(user.name)) {\r\n\t\t\t\tthis.lastRename = {\r\n\t\t\t\t\tfrom: args[2],\r\n\t\t\t\t\tto: '',\r\n\t\t\t\t\telement: document.createElement('div'),\r\n\t\t\t\t};\r\n\t\t\t\tthis.lastRename.element.className = 'chat';\r\n\t\t\t}\r\n\t\t\tthis.lastRename.to = user.group + user.name;\r\n\t\t\tthis.lastRename.element.innerHTML = `<small>${BattleLog.escapeHTML(this.lastRename.to)} renamed from ${BattleLog.escapeHTML(this.lastRename.from)}.</small>`;\r\n\t\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(this.lastRename.element);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcase 'chatmsg': case '':\r\n\t\t\tdivHTML = BattleLog.escapeHTML(args[1]);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'chatmsg-raw': case 'raw': case 'html':\r\n\t\t\tdivHTML = BattleLog.sanitizeHTML(args[1]);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'uhtml': case 'uhtmlchange':\r\n\t\t\tthis.changeUhtml(args[1], args[2], args[0] === 'uhtml');\r\n\t\t\treturn ['', ''];\r\n\r\n\t\tcase 'error': case 'inactive': case 'inactiveoff':\r\n\t\t\tdivClass = 'chat message-error';\r\n\t\t\tdivHTML = BattleLog.escapeHTML(args[1]);\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'bigerror':\r\n\t\t\tthis.message('<div class=\"broadcast-red\">' + BattleLog.escapeHTML(args[1]).replace(/\\|/g, '<br />') + '</div>');\r\n\t\t\treturn;\r\n\r\n\t\tcase 'pm':\r\n\t\t\tdivHTML = '<strong>' + BattleLog.escapeHTML(args[1]) + ':</strong> <span class=\"message-pm\"><i style=\"cursor:pointer\" onclick=\"selectTab(\\'lobby\\');rooms.lobby.popupOpen(\\'' + BattleLog.escapeHTML(args[2], true) + '\\')\">(Private to ' + BattleLog.escapeHTML(args[3]) + ')</i> ' + BattleLog.parseMessage(args[4]) + '</span>';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'askreg':\r\n\t\t\tthis.addDiv('chat', '<div class=\"broadcast-blue\"><b>Register an account to protect your ladder rating!</b><br /><button name=\"register\" value=\"' + BattleLog.escapeHTML(args[1]) + '\"><b>Register</b></button></div>');\r\n\t\t\treturn;\r\n\r\n\t\tcase 'unlink': {\r\n\t\t\t// |unlink| is deprecated in favor of |hidelines|\r\n\t\t\tconst user = toID(args[2]) || toID(args[1]);\r\n\t\t\tthis.unlinkChatFrom(user);\r\n\t\t\tif (args[2]) {\r\n\t\t\t\tconst lineCount = parseInt(args[3], 10);\r\n\t\t\t\tthis.hideChatFrom(user, true, lineCount);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcase 'hidelines': {\r\n\t\t\tconst user = toID(args[2]);\r\n\t\t\tthis.unlinkChatFrom(user);\r\n\t\t\tif (args[1] !== 'unlink') {\r\n\t\t\t\tconst lineCount = parseInt(args[3], 10);\r\n\t\t\t\tthis.hideChatFrom(user, args[1] === 'hide', lineCount);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tcase 'debug':\r\n\t\t\tdivClass = 'debug';\r\n\t\t\tdivHTML = '<div class=\"chat\"><small style=\"color:#999\">[DEBUG] ' + BattleLog.escapeHTML(args[1]) + '.</small></div>';\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'notify':\r\n\t\t\tconst title = args[1];\r\n\t\t\tconst body = args[2];\r\n\t\t\tconst roomid = this.scene?.battle.roomid;\r\n\t\t\tif (!roomid) break;\r\n\t\t\tapp.rooms[roomid].notifyOnce(title, body, 'highlight');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'seed': case 'choice': case ':': case 'timer': case 't:':\r\n\t\tcase 'J': case 'L': case 'N': case 'spectator': case 'spectatorleave':\r\n\t\tcase 'initdone':\r\n\t\t\treturn;\r\n\r\n\t\tdefault:\r\n\t\t\tthis.addBattleMessage(args, kwArgs);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (divHTML) this.addDiv(divClass, divHTML, preempt);\r\n\t}\r\n\taddBattleMessage(args: Args, kwArgs?: KWArgs) {\r\n\t\tswitch (args[0]) {\r\n\t\tcase 'warning':\r\n\t\t\tthis.message('<strong>Warning:</strong> ' + BattleLog.escapeHTML(args[1]));\r\n\t\t\tthis.message(`Bug? Report it to <a href=\"http://www.smogon.com/forums/showthread.php?t=3453192\">the replay viewer's Smogon thread</a>`);\r\n\t\t\tif (this.scene) this.scene.wait(1000);\r\n\t\t\treturn;\r\n\r\n\t\tcase 'variation':\r\n\t\t\tthis.addDiv('', '<small>Variation: <em>' + BattleLog.escapeHTML(args[1]) + '</em></small>');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'rule':\r\n\t\t\tconst ruleArgs = args[1].split(': ');\r\n\t\t\tthis.addDiv('', '<small><em>' + BattleLog.escapeHTML(ruleArgs[0]) + (ruleArgs[1] ? ':' : '') + '</em> ' + BattleLog.escapeHTML(ruleArgs[1] || '') + '</small>');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'rated':\r\n\t\t\tthis.addDiv('rated', '<strong>' + (BattleLog.escapeHTML(args[1]) || 'Rated battle') + '</strong>');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'tier':\r\n\t\t\tthis.addDiv('', '<small>Format:</small> <br /><strong>' + BattleLog.escapeHTML(args[1]) + '</strong>');\r\n\t\t\tbreak;\r\n\r\n\t\tcase 'turn':\r\n\t\t\tconst h2elem = document.createElement('h2');\r\n\t\t\th2elem.className = 'battle-history';\r\n\t\t\tlet turnMessage;\r\n\t\t\tif (this.battleParser) {\r\n\t\t\t\tturnMessage = this.battleParser.parseArgs(args, {}).trim();\r\n\t\t\t\tif (!turnMessage.startsWith('==') || !turnMessage.endsWith('==')) {\r\n\t\t\t\t\tthrow new Error(\"Turn message must be a heading.\");\r\n\t\t\t\t}\r\n\t\t\t\tturnMessage = turnMessage.slice(2, -2).trim();\r\n\t\t\t\tthis.battleParser.curLineSection = 'break';\r\n\t\t\t} else {\r\n\t\t\t\tturnMessage = `Turn ${args[1]}`;\r\n\t\t\t}\r\n\t\t\th2elem.innerHTML = BattleLog.escapeHTML(turnMessage);\r\n\t\t\tthis.addSpacer();\r\n\t\t\tthis.addNode(h2elem);\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tlet line = null;\r\n\t\t\tif (this.battleParser) {\r\n\t\t\t\tline = this.battleParser.parseArgs(args, kwArgs || {}, true);\r\n\t\t\t}\r\n\t\t\tif (line === null) {\r\n\t\t\t\tthis.addDiv('chat message-error', 'Unrecognized: |' + BattleLog.escapeHTML(args.join('|')));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!line) return;\r\n\t\t\tthis.message(...this.parseLogMessage(line));\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\ttextList(list: string[]) {\r\n\t\tlet message = '';\r\n\t\tconst listNoDuplicates: string[] = [];\r\n\t\tfor (const user of list) {\r\n\t\t\tif (!listNoDuplicates.includes(user)) listNoDuplicates.push(user);\r\n\t\t}\r\n\t\tlist = listNoDuplicates;\r\n\r\n\t\tif (list.length === 1) return list[0];\r\n\t\tif (list.length === 2) return `${list[0]} and ${list[1]}`;\r\n\t\tfor (let i = 0; i < list.length - 1; i++) {\r\n\t\t\tif (i >= 5) {\r\n\t\t\t\treturn `${message}and ${list.length - 5} others`;\r\n\t\t\t}\r\n\t\t\tmessage += `${list[i]}, `;\r\n\t\t}\r\n\t\treturn `${message}and ${list[list.length - 1]}`;\r\n\t\treturn message;\r\n\t}\r\n\t/**\r\n\t * To avoid trolling with nicknames, we can't just run this through\r\n\t * parseMessage\r\n\t */\r\n\tparseLogMessage(message: string): [string, string] {\r\n\t\tconst messages = message.split('\\n').map(line => {\r\n\t\t\tline = BattleLog.escapeHTML(line);\r\n\t\t\tline = line.replace(/\\*\\*(.*)\\*\\*/, '<strong>$1</strong>');\r\n\t\t\tline = line.replace(/\\|\\|([^\\|]*)\\|\\|([^\\|]*)\\|\\|/, '<abbr title=\"$1\">$2</abbr>');\r\n\t\t\tif (line.startsWith('  ')) line = '<small>' + line.trim() + '</small>';\r\n\t\t\treturn line;\r\n\t\t});\r\n\t\treturn [\r\n\t\t\tmessages.join('<br />'),\r\n\t\t\tmessages.filter(line => !line.startsWith('<small>[')).join('<br />'),\r\n\t\t];\r\n\t}\r\n\tmessage(message: string, sceneMessage = message) {\r\n\t\tif (this.scene) this.scene.message(sceneMessage);\r\n\t\tthis.addDiv('battle-history', message);\r\n\t}\r\n\taddNode(node: HTMLElement, preempt?: boolean) {\r\n\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(node);\r\n\t\tif (this.atBottom) {\r\n\t\t\tthis.elem.scrollTop = this.elem.scrollHeight;\r\n\t\t}\r\n\t}\r\n\tupdateScroll() {\r\n\t\tif (this.atBottom) {\r\n\t\t\tthis.elem.scrollTop = this.elem.scrollHeight;\r\n\t\t}\r\n\t}\r\n\taddDiv(className: string, innerHTML: string, preempt?: boolean) {\r\n\t\tconst el = document.createElement('div');\r\n\t\tel.className = className;\r\n\t\tel.innerHTML = innerHTML;\r\n\t\tthis.addNode(el, preempt);\r\n\t}\r\n\tprependDiv(className: string, innerHTML: string, preempt?: boolean) {\r\n\t\tconst el = document.createElement('div');\r\n\t\tel.className = className;\r\n\t\tel.innerHTML = innerHTML;\r\n\t\tif (this.innerElem.childNodes.length) {\r\n\t\t\tthis.innerElem.insertBefore(el, this.innerElem.childNodes[0]);\r\n\t\t} else {\r\n\t\t\tthis.innerElem.appendChild(el);\r\n\t\t}\r\n\t\tthis.updateScroll();\r\n\t}\r\n\taddSpacer() {\r\n\t\tthis.addDiv('spacer battle-history', '<br />');\r\n\t}\r\n\tchangeUhtml(id: string, htmlSrc: string, forceAdd?: boolean) {\r\n\t\tid = toID(id);\r\n\t\tconst classContains = ' uhtml-' + id + ' ';\r\n\t\tlet elements = [] as HTMLDivElement[];\r\n\t\tfor (const node of this.innerElem.childNodes as any) {\r\n\t\t\tif (node.className && (' ' + node.className + ' ').includes(classContains)) {\r\n\t\t\t\telements.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.preemptElem) {\r\n\t\t\tfor (const node of this.preemptElem.childNodes as any) {\r\n\t\t\t\tif (node.className && (' ' + node.className + ' ').includes(classContains)) {\r\n\t\t\t\t\telements.push(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (htmlSrc && elements.length && !forceAdd) {\r\n\t\t\tfor (const element of elements) {\r\n\t\t\t\telement.innerHTML = BattleLog.sanitizeHTML(htmlSrc);\r\n\t\t\t}\r\n\t\t\tthis.updateScroll();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (const element of elements) {\r\n\t\t\telement.parentElement!.removeChild(element);\r\n\t\t}\r\n\t\tif (!htmlSrc) return;\r\n\t\tif (forceAdd) {\r\n\t\t\tthis.addDiv('notice uhtml-' + id, BattleLog.sanitizeHTML(htmlSrc));\r\n\t\t} else {\r\n\t\t\tthis.prependDiv('notice uhtml-' + id, BattleLog.sanitizeHTML(htmlSrc));\r\n\t\t}\r\n\t}\r\n\thideChatFrom(userid: ID, showRevealButton = true, lineCount = 0) {\r\n\t\tconst classStart = 'chat chatmessage-' + userid + ' ';\r\n\t\tlet nodes: HTMLElement[] = [];\r\n\t\tfor (const node of this.innerElem.childNodes as any as HTMLElement[]) {\r\n\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\r\n\t\t\t\tnodes.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.preemptElem) {\r\n\t\t\tfor (const node of this.preemptElem.childNodes as any as HTMLElement[]) {\r\n\t\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\r\n\t\t\t\t\tnodes.push(node);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (lineCount) nodes = nodes.slice(-lineCount);\r\n\r\n\t\tfor (const node of nodes) {\r\n\t\t\tnode.style.display = 'none';\r\n\t\t\tnode.className = 'revealed ' + node.className;\r\n\t\t}\r\n\t\tif (!nodes.length || !showRevealButton) return;\r\n\t\tconst button = document.createElement('button');\r\n\t\tbutton.name = 'toggleMessages';\r\n\t\tbutton.value = userid;\r\n\t\tbutton.className = 'subtle';\r\n\t\tbutton.innerHTML = `<small>(${nodes.length} line${nodes.length > 1 ? 's' : ''} from ${userid} hidden)</small>`;\r\n\t\tconst lastNode = nodes[nodes.length - 1];\r\n\t\tlastNode.appendChild(document.createTextNode(' '));\r\n\t\tlastNode.appendChild(button);\r\n\t}\r\n\r\n\tstatic unlinkNodeList(nodeList: ArrayLike<HTMLElement>, classStart: string) {\r\n\t\tfor (const node of nodeList as HTMLElement[]) {\r\n\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\r\n\t\t\t\tconst linkList = node.getElementsByTagName('a');\r\n\t\t\t\t// iterate in reverse because linkList will update as links are removed\r\n\t\t\t\tfor (let i = linkList.length - 1; i >= 0; i--) {\r\n\t\t\t\t\tconst linkNode = linkList[i];\r\n\t\t\t\t\tconst parent = linkNode.parentElement;\r\n\t\t\t\t\tif (!parent) continue;\r\n\t\t\t\t\tfor (const childNode of linkNode.childNodes as any) {\r\n\t\t\t\t\t\tparent.insertBefore(childNode, linkNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparent.removeChild(linkNode);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tunlinkChatFrom(userid: ID) {\r\n\t\tconst classStart = 'chat chatmessage-' + userid + ' ';\r\n\t\tconst innerNodeList = this.innerElem.childNodes;\r\n\t\tBattleLog.unlinkNodeList(innerNodeList as NodeListOf<HTMLElement>, classStart);\r\n\r\n\t\tif (this.preemptElem) {\r\n\t\t\tconst preemptNodeList = this.preemptElem.childNodes;\r\n\t\t\tBattleLog.unlinkNodeList(preemptNodeList as NodeListOf<HTMLElement>, classStart);\r\n\t\t}\r\n\t}\r\n\r\n\tpreemptCatchup() {\r\n\t\tif (!this.preemptElem.firstChild) return;\r\n\t\tthis.innerElem.appendChild(this.preemptElem.firstChild);\r\n\t}\r\n\r\n\tstatic escapeFormat(formatid: string): string {\r\n\t\tlet atIndex = formatid.indexOf('@@@');\r\n\t\tif (atIndex >= 0) {\r\n\t\t\treturn this.escapeFormat(formatid.slice(0, atIndex)) +\r\n\t\t\t\t'<br />Custom rules: ' + this.escapeHTML(formatid.slice(atIndex + 3));\r\n\t\t}\r\n\t\tif (window.BattleFormats && BattleFormats[formatid]) {\r\n\t\t\treturn this.escapeHTML(BattleFormats[formatid].name);\r\n\t\t}\r\n\t\tif (window.NonBattleGames && NonBattleGames[formatid]) {\r\n\t\t\treturn this.escapeHTML(NonBattleGames[formatid]);\r\n\t\t}\r\n\t\treturn this.escapeHTML(formatid);\r\n\t}\r\n\r\n\tstatic escapeHTML(str: string, jsEscapeToo?: boolean) {\r\n\t\tif (typeof str !== 'string') return '';\r\n\t\tstr = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n\t\tif (jsEscapeToo) str = str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, '\\\\\\'');\r\n\t\treturn str;\r\n\t}\r\n\r\n\tstatic unescapeHTML(str: string) {\r\n\t\tstr = (str ? '' + str : '');\r\n\t\treturn str.replace(/&quot;/g, '\"').replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&');\r\n\t}\r\n\r\n\tstatic colorCache: {[userid: string]: string} = {};\r\n\r\n\t/** @deprecated */\r\n\tstatic hashColor(name: ID) {\r\n\t\treturn `color:${this.usernameColor(name)};`;\r\n\t}\r\n\r\n\tstatic usernameColor(name: ID) {\r\n\t\tif (this.colorCache[name]) return this.colorCache[name];\r\n\t\tlet hash;\r\n\t\tif (Config.customcolors[name]) {\r\n\t\t\thash = MD5(Config.customcolors[name]);\r\n\t\t} else {\r\n\t\t\thash = MD5(name);\r\n\t\t}\r\n\t\tlet H = parseInt(hash.substr(4, 4), 16) % 360; // 0 to 360\r\n\t\tlet S = parseInt(hash.substr(0, 4), 16) % 50 + 40; // 40 to 89\r\n\t\tlet L = Math.floor(parseInt(hash.substr(8, 4), 16) % 20 + 30); // 30 to 49\r\n\r\n\t\tlet {R, G, B} = this.HSLToRGB(H, S, L);\r\n\t\tlet lum = R * R * R * 0.2126 + G * G * G * 0.7152 + B * B * B * 0.0722; // 0.013 (dark blue) to 0.737 (yellow)\r\n\r\n\t\tlet HLmod = (lum - 0.2) * -150; // -80 (yellow) to 28 (dark blue)\r\n\t\tif (HLmod > 18) HLmod = (HLmod - 18) * 2.5;\r\n\t\telse if (HLmod < 0) HLmod = (HLmod - 0) / 3;\r\n\t\telse HLmod = 0;\r\n\t\t// let mod = ';border-right: ' + Math.abs(HLmod) + 'px solid ' + (HLmod > 0 ? 'red' : '#0088FF');\r\n\t\tlet Hdist = Math.min(Math.abs(180 - H), Math.abs(240 - H));\r\n\t\tif (Hdist < 15) {\r\n\t\t\tHLmod += (15 - Hdist) / 3;\r\n\t\t}\r\n\r\n\t\tL += HLmod;\r\n\r\n\t\tlet {R: r, G: g, B: b} = this.HSLToRGB(H, S, L);\r\n\t\tconst toHex = (x: number) => {\r\n\t\t\tconst hex = Math.round(x * 255).toString(16);\r\n\t\t\treturn hex.length === 1 ? '0' + hex : hex;\r\n\t\t};\r\n\t\tthis.colorCache[name] = `#${toHex(r)}${toHex(g)}${toHex(b)}`;\r\n\t\treturn this.colorCache[name];\r\n\t}\r\n\r\n\tstatic HSLToRGB(H: number, S: number, L: number) {\r\n\t\tlet C = (100 - Math.abs(2 * L - 100)) * S / 100 / 100;\r\n\t\tlet X = C * (1 - Math.abs((H / 60) % 2 - 1));\r\n\t\tlet m = L / 100 - C / 2;\r\n\r\n\t\tlet R1;\r\n\t\tlet G1;\r\n\t\tlet B1;\r\n\t\tswitch (Math.floor(H / 60)) {\r\n\t\tcase 1: R1 = X; G1 = C; B1 = 0; break;\r\n\t\tcase 2: R1 = 0; G1 = C; B1 = X; break;\r\n\t\tcase 3: R1 = 0; G1 = X; B1 = C; break;\r\n\t\tcase 4: R1 = X; G1 = 0; B1 = C; break;\r\n\t\tcase 5: R1 = C; G1 = 0; B1 = X; break;\r\n\t\tcase 0: default: R1 = C; G1 = X; B1 = 0; break;\r\n\t\t}\r\n\t\tlet R = R1 + m;\r\n\t\tlet G = G1 + m;\r\n\t\tlet B = B1 + m;\r\n\t\treturn {R, G, B};\r\n\t}\r\n\r\n\tstatic prefs(name: string) {\r\n\t\t// @ts-ignore\r\n\t\tif (window.Storage?.prefs) return Storage.prefs(name);\r\n\t\t// @ts-ignore\r\n\t\tif (window.PS) return PS.prefs[name];\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tparseChatMessage(\r\n\t\tmessage: string, name: string, timestamp: string, isHighlighted?: boolean\r\n\t): [string, string, boolean?] {\r\n\t\tlet showMe = !BattleLog.prefs('chatformatting')?.hideme;\r\n\t\tlet group = ' ';\r\n\t\tif (!/[A-Za-z0-9]/.test(name.charAt(0))) {\r\n\t\t\t// Backwards compatibility\r\n\t\t\tgroup = name.charAt(0);\r\n\t\t\tname = name.substr(1);\r\n\t\t}\r\n\t\tconst colorStyle = ` style=\"color:${BattleLog.usernameColor(toID(name))}\"`;\r\n\t\tconst clickableName = `<small>${BattleLog.escapeHTML(group)}</small><span class=\"username\" data-name=\"${BattleLog.escapeHTML(name)}\">${BattleLog.escapeHTML(name)}</span>`;\r\n\t\tlet hlClass = isHighlighted ? ' highlighted' : '';\r\n\t\tlet isMine = (window.app?.user?.get('name') === name) || (window.PS?.user.name === name);\r\n\t\tlet mineClass = isMine ? ' mine' : '';\r\n\r\n\t\tlet cmd = '';\r\n\t\tlet target = '';\r\n\t\tif (message.charAt(0) === '/') {\r\n\t\t\tif (message.charAt(1) === '/') {\r\n\t\t\t\tmessage = message.slice(1);\r\n\t\t\t} else {\r\n\t\t\t\tlet spaceIndex = message.indexOf(' ');\r\n\t\t\t\tcmd = (spaceIndex >= 0 ? message.slice(1, spaceIndex) : message.slice(1));\r\n\t\t\t\tif (spaceIndex >= 0) target = message.slice(spaceIndex + 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tswitch (cmd) {\r\n\t\tcase 'me':\r\n\t\tcase 'mee':\r\n\t\t\tlet parsedMessage = BattleLog.parseMessage(' ' + target);\r\n\t\t\tif (cmd === 'mee') parsedMessage = parsedMessage.slice(1);\r\n\t\t\tif (!showMe) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>/me${parsedMessage}</em>`,\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\treturn [\r\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t`${timestamp}<em><i><strong${colorStyle}>&bull; ${clickableName}</strong>${parsedMessage}</i></em>`,\r\n\t\t\t];\r\n\t\tcase 'invite':\r\n\t\t\tlet roomid = toRoomid(target);\r\n\t\t\treturn [\r\n\t\t\t\t'chat',\r\n\t\t\t\t`${timestamp}<em>${clickableName} invited you to join the room \"${roomid}\"</em>' +\r\n\t\t\t\t'<div class=\"notice\"><button name=\"joinRoom\" value=\"${roomid}\">Join ${roomid}</button></div>`,\r\n\t\t\t];\r\n\t\tcase 'announce':\r\n\t\t\treturn [\r\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <span class=\"message-announce\">${BattleLog.parseMessage(target)}</span>`,\r\n\t\t\t];\r\n\t\tcase 'log':\r\n\t\t\treturn [\r\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t`${timestamp}<span class=\"message-log\">${BattleLog.parseMessage(target)}</span>`,\r\n\t\t\t];\r\n\t\tcase 'data-pokemon':\r\n\t\tcase 'data-item':\r\n\t\tcase 'data-ability':\r\n\t\tcase 'data-move':\r\n\t\t\treturn ['chat message-error', '[outdated code no longer supported]'];\r\n\t\tcase 'text':\r\n\t\t\treturn ['chat', BattleLog.parseMessage(target)];\r\n\t\tcase 'error':\r\n\t\t\treturn ['chat message-error', formatText(target, true)];\r\n\t\tcase 'html':\r\n\t\t\treturn [\r\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>${BattleLog.sanitizeHTML(target)}</em>`,\r\n\t\t\t];\r\n\t\tcase 'uhtml':\r\n\t\tcase 'uhtmlchange':\r\n\t\t\tlet parts = target.split(',');\r\n\t\t\tlet htmlSrc = parts.slice(1).join(',').trim();\r\n\t\t\tthis.changeUhtml(parts[0], htmlSrc, cmd === 'uhtml');\r\n\t\t\treturn ['', ''];\r\n\t\tcase 'raw':\r\n\t\t\treturn ['chat', BattleLog.sanitizeHTML(target)];\r\n\t\tcase 'nonotify':\r\n\t\t\treturn ['chat', BattleLog.sanitizeHTML(target), true];\r\n\t\tdefault:\r\n\t\t\t// Not a command or unsupported. Parsed as a normal chat message.\r\n\t\t\tif (!name) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t'chat' + hlClass,\r\n\t\t\t\t\t`${timestamp}<em>${BattleLog.parseMessage(message)}</em>`,\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\treturn [\r\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\r\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>${BattleLog.parseMessage(message)}</em>`,\r\n\t\t\t];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic parseMessage(str: string, isTrusted = false) {\r\n\t\t// Don't format console commands (>>).\r\n\t\tif (str.substr(0, 3) === '>> ' || str.substr(0, 4) === '>>> ') return this.escapeHTML(str);\r\n\t\t// Don't format console results (<<).\r\n\t\tif (str.substr(0, 3) === '<< ') return this.escapeHTML(str);\r\n\t\tstr = formatText(str, isTrusted);\r\n\r\n\t\tlet options = BattleLog.prefs('chatformatting') || {};\r\n\r\n\t\tif (options.hidelinks) {\r\n\t\t\tstr = str.replace(/<a[^>]*>/g, '<u>').replace(/<\\/a>/g, '</u>');\r\n\t\t}\r\n\t\tif (options.hidespoiler) {\r\n\t\t\tstr = str.replace(/<span class=\"spoiler\">/g, '<span class=\"spoiler spoiler-shown\">');\r\n\t\t}\r\n\t\tif (options.hidegreentext) {\r\n\t\t\tstr = str.replace(/<span class=\"greentext\">/g, '<span>');\r\n\t\t}\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\tstatic interstice = (() => {\r\n\t\tconst whitelist: string[] = Config.whitelist;\r\n\t\tconst patterns = whitelist.map(entry => new RegExp(\r\n\t\t\t`^(https?:)?//([A-Za-z0-9-]*\\\\.)?${entry.replace(/\\./g, '\\\\.')}(/.*)?`,\r\n\t\t'i'));\r\n\t\treturn {\r\n\t\t\tisWhitelisted(uri: string) {\r\n\t\t\t\tif (uri[0] === '/' && uri[1] !== '/') {\r\n\t\t\t\t\t// domain-relative URIs are safe\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\tfor (const pattern of patterns) {\r\n\t\t\t\t\tif (pattern.test(uri)) return true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tgetURI(uri: string) {\r\n\t\t\t\treturn `http://${Config.routes.root}/interstice?uri=${encodeURIComponent(uri)}`;\r\n\t\t\t},\r\n\t\t};\r\n\t})();\r\n\r\n\tstatic players: any[] = [];\r\n\tstatic ytLoading: Promise<void> | null = null;\r\n\tstatic tagPolicy: ((tagName: string, attribs: string[]) => any) | null = null;\r\n\tstatic initSanitizeHTML() {\r\n\t\tif (this.tagPolicy) return;\r\n\t\tif (!('html4' in window)) {\r\n\t\t\tthrow new Error('sanitizeHTML requires caja');\r\n\t\t}\r\n\r\n\t\t// By default, Caja will ban any HTML tags it doesn't recognize.\r\n\t\t// Additional HTML tags to allow:\r\n\t\tObject.assign(html4.ELEMENTS, {\r\n\t\t\tmarquee: 0,\r\n\t\t\tblink: 0,\r\n\t\t\tpsicon: html4.eflags['OPTIONAL_ENDTAG'] | html4.eflags['EMPTY'],\r\n\t\t\tusername: 0,\r\n\t\t\tspotify: 0,\r\n\t\t\tyoutube: 0,\r\n\t\t\ttwitch: 0,\r\n\t\t});\r\n\r\n\t\t// By default, Caja will ban any attributes it doesn't recognize.\r\n\t\t// Additional attributes to allow:\r\n\t\tObject.assign(html4.ATTRIBS, {\r\n\t\t\t// See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/marquee\r\n\t\t\t'marquee::behavior': 0,\r\n\t\t\t'marquee::bgcolor': 0,\r\n\t\t\t'marquee::direction': 0,\r\n\t\t\t'marquee::height': 0,\r\n\t\t\t'marquee::hspace': 0,\r\n\t\t\t'marquee::loop': 0,\r\n\t\t\t'marquee::scrollamount': 0,\r\n\t\t\t'marquee::scrolldelay': 0,\r\n\t\t\t'marquee::truespeed': 0,\r\n\t\t\t'marquee::vspace': 0,\r\n\t\t\t'marquee::width': 0,\r\n\t\t\t'psicon::pokemon': 0,\r\n\t\t\t'psicon::item': 0,\r\n\t\t\t'psicon::type': 0,\r\n\t\t\t'psicon::category': 0,\r\n\t\t\t'username::name': 0,\r\n\t\t\t'form::data-submitsend': 0,\r\n\t\t\t'div::data-server': 0,\r\n\t\t\t'button::data-send': 0,\r\n\t\t\t'form::data-delimiter': 0,\r\n\t\t\t'button::data-delimiter': 0,\r\n\t\t\t'*::aria-label': 0,\r\n\t\t\t'*::aria-hidden': 0,\r\n\t\t});\r\n\r\n\t\t// Caja unfortunately doesn't document how `tagPolicy` works, so\r\n\t\t// here's how it goes:\r\n\r\n\t\t// Every opening tag and attributes is filtered through\r\n\t\t// `tagPolicy`, being replaced by the {tagName, attribs} returned.\r\n\t\t// Returning `undefined` means that the tag will be removed entirely.\r\n\r\n\t\t// We run Caja's built-in tag sanitization in the first line of our\r\n\t\t// custom tagPolicy, and its attribs sanitization midway through, with\r\n\t\t// `sanitizeAttribs`.\r\n\r\n\t\t// (n.b. tag contents etc can't be modified in this step.)\r\n\r\n\t\t/**\r\n\t\t * @param tagName Lowercase tag name\r\n\t\t * @param attribs attribs in the form of [key, value, key, value]\r\n\t\t * @return undefined to remove the tag\r\n\t\t */\r\n\t\tthis.tagPolicy = (tagName: string, attribs: string[]) => {\r\n\t\t\tif (html4.ELEMENTS[tagName] & html4.eflags['UNSAFE']) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfunction getAttrib(key: string) {\r\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\r\n\t\t\t\t\tif (attribs[i] === key) {\r\n\t\t\t\t\t\treturn attribs[i + 1];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t\tfunction setAttrib(key: string, value: string) {\r\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\r\n\t\t\t\t\tif (attribs[i] === key) {\r\n\t\t\t\t\t\tattribs[i + 1] = value;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tattribs.push(key, value);\r\n\t\t\t}\r\n\t\t\tfunction deleteAttrib(key: string) {\r\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\r\n\t\t\t\t\tif (attribs[i] === key) {\r\n\t\t\t\t\t\tattribs.splice(i, 2);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet dataUri = '';\r\n\t\t\tlet targetReplace = false;\r\n\r\n\t\t\tif (tagName === 'a') {\r\n\t\t\t\tif (getAttrib('target') === 'replace') {\r\n\t\t\t\t\ttargetReplace = true;\r\n\t\t\t\t}\r\n\t\t\t} else if (tagName === 'img') {\r\n\t\t\t\tconst src = getAttrib('src') || '';\r\n\t\t\t\tif (src.startsWith('data:image/')) {\r\n\t\t\t\t\tdataUri = src;\r\n\t\t\t\t}\r\n\t\t\t\tif (src.startsWith('//')) {\r\n\t\t\t\t\tif (location.protocol !== 'http:' && location.protocol !== 'https:') {\r\n\t\t\t\t\t\t// in testclient with `file://`, fix src so it still works\r\n\t\t\t\t\t\tsetAttrib('src', 'https:' + src);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (tagName === 'twitch') {\r\n\t\t\t\t// <iframe src=\"https://player.twitch.tv/?channel=ninja&parent=www.example.com\" allowfullscreen=\"true\" height=\"378\" width=\"620\"></iframe>\r\n\t\t\t\tconst src = getAttrib('src') || \"\";\r\n\t\t\t\tconst channelId = /(https?:\\/\\/)?twitch.tv\\/([A-Za-z0-9]+)/i.exec(src)?.[2];\r\n\t\t\t\tconst height = parseInt(getAttrib('height') || \"\", 10) || 400;\r\n\t\t\t\tconst width = parseInt(getAttrib('width') || \"\", 10) || 340;\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttagName: 'iframe',\r\n\t\t\t\t\tattribs: [\r\n\t\t\t\t\t\t'src', `https://player.twitch.tv/?channel=${channelId}&parent=${location.hostname}&autoplay=false`,\r\n\t\t\t\t\t\t'allowfullscreen', 'true', 'height', `${height}`, 'width', `${width}`,\r\n\t\t\t\t\t],\r\n\t\t\t\t};\r\n\t\t\t} else if (tagName === 'username') {\r\n\t\t\t\t// <username> is a custom element that handles namecolors\r\n\t\t\t\ttagName = 'strong';\r\n\t\t\t\tconst color = this.usernameColor(toID(getAttrib('name')));\r\n\t\t\t\tconst style = getAttrib('style');\r\n\t\t\t\tsetAttrib('style', `${style};color:${color}`);\r\n\t\t\t} else if (tagName === 'spotify') {\r\n\t\t\t\t// <iframe src=\"https://open.spotify.com/embed/track/6aSYnCIwcLpnDXngGKAEzZ\" width=\"300\" height=\"380\" frameborder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\"></iframe>\r\n\t\t\t\tconst src = getAttrib('src') || '';\r\n\t\t\t\tconst songId = /(?:\\?v=|\\/track\\/)([A-Za-z0-9]+)/.exec(src)?.[1];\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttagName: 'iframe',\r\n\t\t\t\t\tattribs: ['src', `https://open.spotify.com/embed/track/${songId}`, 'width', '300', 'height', '380', 'frameborder', '0', 'allowtransparency', 'true', 'allow', 'encrypted-media'],\r\n\t\t\t\t};\r\n\t\t\t} else if (tagName === 'youtube') {\r\n\t\t\t\t// <iframe width=\"320\" height=\"180\" src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\r\n\r\n\t\t\t\tconst src = getAttrib('src') || '';\r\n\t\t\t\t// Google's ToS requires a minimum of 200x200\r\n\t\t\t\tlet width = '320';\r\n\t\t\t\tlet height = '200';\r\n\t\t\t\tif (window.innerWidth >= 400) {\r\n\t\t\t\t\twidth = '400';\r\n\t\t\t\t\theight = '225';\r\n\t\t\t\t}\r\n\t\t\t\tconst videoId = /(?:\\?v=|\\/embed\\/)([A-Za-z0-9_\\-]+)/.exec(src)?.[1];\r\n\t\t\t\tif (!videoId) return {tagName: 'img', attribs: ['alt', `invalid src for <youtube>`]};\r\n\r\n\t\t\t\tconst time = /(?:\\?|&)(?:t|start)=([0-9]+)/.exec(src)?.[1];\r\n\t\t\t\tthis.players.push(null);\r\n\t\t\t\tconst idx = this.players.length;\r\n\t\t\t\tthis.initYoutubePlayer(idx);\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttagName: 'iframe',\r\n\t\t\t\t\tattribs: [\r\n\t\t\t\t\t\t'id', `youtube-iframe-${idx}`,\r\n\t\t\t\t\t\t'width', width, 'height', height,\r\n\t\t\t\t\t\t'src', `https://www.youtube.com/embed/${videoId}?enablejsapi=1&playsinline=1${time ? `&start=${time}` : ''}`,\r\n\t\t\t\t\t\t'frameborder', '0', 'allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture', 'allowfullscreen', 'allowfullscreen',\r\n\t\t\t\t\t],\r\n\t\t\t\t};\r\n\t\t\t} else if (tagName === 'psicon') {\r\n\t\t\t\t// <psicon> is a custom element which supports a set of mutually incompatible attributes:\r\n\t\t\t\t// <psicon pokemon> and <psicon item>\r\n\t\t\t\tlet iconType = null;\r\n\t\t\t\tlet iconValue = null;\r\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\r\n\t\t\t\t\tif (attribs[i] === 'pokemon' || attribs[i] === 'item' || attribs[i] === 'type' || attribs[i] === 'category') {\r\n\t\t\t\t\t\t[iconType, iconValue] = attribs.slice(i, i + 2);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ttagName = 'span';\r\n\r\n\t\t\t\tif (iconType) {\r\n\t\t\t\t\tconst className = getAttrib('class');\r\n\t\t\t\t\tconst style = getAttrib('style');\r\n\r\n\t\t\t\t\tif (iconType === 'pokemon') {\r\n\t\t\t\t\t\tsetAttrib('class', 'picon' + (className ? ' ' + className : ''));\r\n\t\t\t\t\t\tsetAttrib('style', Dex.getPokemonIcon(iconValue) + (style ? '; ' + style : ''));\r\n\t\t\t\t\t} else if (iconType === 'item') {\r\n\t\t\t\t\t\tsetAttrib('class', 'itemicon' + (className ? ' ' + className : ''));\r\n\t\t\t\t\t\tsetAttrib('style', Dex.getItemIcon(iconValue) + (style ? '; ' + style : ''));\r\n\t\t\t\t\t} else if (iconType === 'type') {\r\n\t\t\t\t\t\ttagName = Dex.getTypeIcon(iconValue).slice(1, -3);\r\n\t\t\t\t\t} else if (iconType === 'category') {\r\n\t\t\t\t\t\ttagName = Dex.getCategoryIcon(iconValue).slice(1, -3);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tattribs = html.sanitizeAttribs(tagName, attribs, (urlData: any) => {\r\n\t\t\t\tif (urlData.scheme_ === 'geo' || urlData.scheme_ === 'sms' || urlData.scheme_ === 'tel') return null;\r\n\t\t\t\treturn urlData;\r\n\t\t\t});\r\n\r\n\t\t\tif (dataUri && tagName === 'img') {\r\n\t\t\t\tsetAttrib('src', dataUri);\r\n\t\t\t}\r\n\t\t\tif (tagName === 'a' || (tagName === 'form' && !getAttrib('data-submitsend'))) {\r\n\t\t\t\tif (targetReplace) {\r\n\t\t\t\t\tsetAttrib('data-target', 'replace');\r\n\t\t\t\t\tdeleteAttrib('target');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetAttrib('target', '_blank');\r\n\t\t\t\t}\r\n\t\t\t\tif (tagName === 'a') {\r\n\t\t\t\t\tsetAttrib('rel', 'noopener');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn {tagName, attribs};\r\n\t\t};\r\n\t}\r\n\tstatic localizeTime(full: string, date: string, time: string, timezone?: string) {\r\n\t\tlet parsedTime = new Date(date + 'T' + time + (timezone || 'Z').toUpperCase());\r\n\t\t// Very old (pre-ES5) web browsers may be incapable of parsing ISO 8601\r\n\t\t// dates. In such a case, gracefully continue without replacing the date\r\n\t\t// format.\r\n\t\tif (!parsedTime.getTime()) return full;\r\n\r\n\t\tlet formattedTime;\r\n\t\t// Try using Intl API if it exists\r\n\t\tif ((window as any).Intl?.DateTimeFormat) {\r\n\t\t\tformattedTime = new Intl.DateTimeFormat(undefined, {\r\n\t\t\t\tmonth: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric',\r\n\t\t\t}).format(parsedTime);\r\n\t\t} else {\r\n\t\t\t// toLocaleString even exists in ECMAScript 1, so no need to check\r\n\t\t\t// if it exists.\r\n\t\t\tformattedTime = parsedTime.toLocaleString();\r\n\t\t}\r\n\t\treturn '<time>' + BattleLog.escapeHTML(formattedTime) + '</time>';\r\n\t}\r\n\tstatic sanitizeHTML(input: string) {\r\n\t\tif (typeof input !== 'string') return '';\r\n\r\n\t\tthis.initSanitizeHTML();\r\n\r\n\t\tinput = input.replace(/<username([^>]*)>([^<]*)<\\/username>/gi, (match, attrs, username) => {\r\n\t\t\tif (/\\bname\\s*=\\s*\"/.test(attrs)) return match;\r\n\t\t\tconst escapedUsername = username.replace(/\"/g, '&quot;').replace(/>/g, '&gt;');\r\n\t\t\treturn `<username${attrs} name=\"${escapedUsername}\">${username}</username>`;\r\n\t\t});\r\n\r\n\t\t// Our custom element support happens in `tagPolicy`, which is set\r\n\t\t// up in `initSanitizeHTML` above.\r\n\t\tconst sanitized = html.sanitizeWithPolicy(input, this.tagPolicy) as string;\r\n\r\n\t\t// <time> parsing requires ISO 8601 time. While more time formats are\r\n\t\t// supported by most JavaScript implementations, it isn't required, and\r\n\t\t// how to exactly enforce ignoring user agent timezone setting is not obvious.\r\n\t\t// As dates come from the server which isn't aware of client timezone, a\r\n\t\t// particular timezone is required.\r\n\t\t//\r\n\t\t// This regular expression is split into three groups.\r\n\t\t//\r\n\t\t// Group 1 - date\r\n\t\t// Group 2 - time (seconds and milliseconds are optional)\r\n\t\t// Group 3 - optional timezone\r\n\t\t//\r\n\t\t// Group 1 and group 2 are split to allow using space as a separator\r\n\t\t// instead of T. Stricly speaking ECMAScript 5 specification only\r\n\t\t// allows T, however it's more practical to also allow spaces.\r\n\t\treturn sanitized.replace(\r\n\t\t\t/<time>\\s*([+-]?\\d{4,}-\\d{2}-\\d{2})[T ](\\d{2}:\\d{2}(?::\\d{2}(?:\\.\\d{3})?)?)(Z|[+-]\\d{2}:\\d{2})?\\s*<\\/time>/ig,\r\n\t\tthis.localizeTime);\r\n\t}\r\n\r\n\tstatic initYoutubePlayer(idx: number) {\r\n\t\tconst id = `youtube-iframe-${idx}`;\r\n\t\tconst loadPlayer = () => {\r\n\t\t\tif (!$(`#${id}`).length) return;\r\n\t\t\tconst player = new window.YT.Player(id, {\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tonStateChange: (event: any) => {\r\n\t\t\t\t\t\tif (event.data === window.YT.PlayerState.PLAYING) {\r\n\t\t\t\t\t\t\tfor (const curPlayer of BattleLog.players) {\r\n\t\t\t\t\t\t\t\tif (player === curPlayer) continue;\r\n\t\t\t\t\t\t\t\tcurPlayer?.pauseVideo?.();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tthis.players[idx - 1] = player;\r\n\t\t};\r\n\t\t// wait for html element to be in DOM\r\n\t\tthis.ensureYoutube().then(() => {\r\n\t\t\tsetTimeout(() => loadPlayer(), 300);\r\n\t\t});\r\n\t}\r\n\r\n\tstatic ensureYoutube(): Promise<void> {\r\n\t\tif (this.ytLoading) return this.ytLoading;\r\n\r\n\t\tthis.ytLoading = new Promise(resolve => {\r\n\t\t\tconst el = document.createElement('script');\r\n\t\t\tel.type = 'text/javascript';\r\n\t\t\tel.async = true;\r\n\t\t\tel.src = 'https://youtube.com/iframe_api';\r\n\t\t\tel.onload = () => {\r\n\t\t\t\t// since the src loads more files remotely we'll just wait\r\n\t\t\t\t// until the player exists\r\n\t\t\t\tconst loopCheck = () => {\r\n\t\t\t\t\tif (!window.YT?.Player) {\r\n\t\t\t\t\t\tsetTimeout(() => loopCheck(), 300);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\tloopCheck();\r\n\t\t\t};\r\n\t\t\tdocument.body.appendChild(el);\r\n\t\t});\r\n\t\treturn this.ytLoading;\r\n\t}\r\n\r\n\t/*********************************************************\r\n\t * Replay files\r\n\t *********************************************************/\r\n\r\n\t// Replay files are .html files that display a replay for a battle.\r\n\r\n\t// The .html files mainly contain replay log data; the actual replay\r\n\t// player is downloaded online. Also included is a textual log and\r\n\t// some minimal CSS to make it look pretty, for offline viewing.\r\n\r\n\t// This strategy helps keep the replay file reasonably small; of\r\n\t// the 30 KB or so for a 50-turn battle, around 10 KB is the log\r\n\t// data, and around 20 KB is the textual log.\r\n\r\n\t// The actual replay player is downloaded from replay-embed.js,\r\n\t// which handles loading all the necessary resources for turning the log\r\n\t// data into a playable replay.\r\n\r\n\t// Battle log data is stored in and loaded from a\r\n\t// <script type=\"text/plain\" class=\"battle-log-data\"> tag.\r\n\r\n\t// replay-embed.js is loaded through a cache-buster that rotates daily.\r\n\t// This allows pretty much anything about the replay viewer to be\r\n\t// updated as desired.\r\n\r\n\tstatic createReplayFile(room: any) {\r\n\t\tlet battle = room.battle;\r\n\t\tlet replayid = room.id;\r\n\t\tif (replayid) {\r\n\t\t\t// battle room\r\n\t\t\treplayid = replayid.slice(7);\r\n\t\t\tif (Config.server.id !== 'showdown') {\r\n\t\t\t\tif (!Config.server.registered) {\r\n\t\t\t\t\treplayid = 'unregisteredserver-' + replayid;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treplayid = Config.server.id + '-' + replayid;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// replay panel\r\n\t\t\treplayid = room.fragment;\r\n\t\t}\r\n\t\tbattle.seekTurn(Infinity);\r\n\t\tlet buf = '<!DOCTYPE html>\\n';\r\n\t\tbuf += '<meta charset=\"utf-8\" />\\n';\r\n\t\tbuf += '<!-- version 1 -->\\n';\r\n\t\tbuf += `<title>${BattleLog.escapeHTML(battle.tier)} replay: ${BattleLog.escapeHTML(battle.p1.name)} vs. ${BattleLog.escapeHTML(battle.p2.name)}</title>\\n`;\r\n\t\tbuf += '<style>\\n';\r\n\t\tbuf += 'html,body {font-family:Verdana, sans-serif;font-size:10pt;margin:0;padding:0;}body{padding:12px 0;} .battle-log {font-family:Verdana, sans-serif;font-size:10pt;} .battle-log-inline {border:1px solid #AAAAAA;background:#EEF2F5;color:black;max-width:640px;margin:0 auto 80px;padding-bottom:5px;} .battle-log .inner {padding:4px 8px 0px 8px;} .battle-log .inner-preempt {padding:0 8px 4px 8px;} .battle-log .inner-after {margin-top:0.5em;} .battle-log h2 {margin:0.5em -8px;padding:4px 8px;border:1px solid #AAAAAA;background:#E0E7EA;border-left:0;border-right:0;font-family:Verdana, sans-serif;font-size:13pt;} .battle-log .chat {vertical-align:middle;padding:3px 0 3px 0;font-size:8pt;} .battle-log .chat strong {color:#40576A;} .battle-log .chat em {padding:1px 4px 1px 3px;color:#000000;font-style:normal;} .chat.mine {background:rgba(0,0,0,0.05);margin-left:-8px;margin-right:-8px;padding-left:8px;padding-right:8px;} .spoiler {color:#BBBBBB;background:#BBBBBB;padding:0px 3px;} .spoiler:hover, .spoiler:active, .spoiler-shown {color:#000000;background:#E2E2E2;padding:0px 3px;} .spoiler a {color:#BBBBBB;} .spoiler:hover a, .spoiler:active a, .spoiler-shown a {color:#2288CC;} .chat code, .chat .spoiler:hover code, .chat .spoiler:active code, .chat .spoiler-shown code {border:1px solid #C0C0C0;background:#EEEEEE;color:black;padding:0 2px;} .chat .spoiler code {border:1px solid #CCCCCC;background:#CCCCCC;color:#CCCCCC;} .battle-log .rated {padding:3px 4px;} .battle-log .rated strong {color:white;background:#89A;padding:1px 4px;border-radius:4px;} .spacer {margin-top:0.5em;} .message-announce {background:#6688AA;color:white;padding:1px 4px 2px;} .message-announce a, .broadcast-green a, .broadcast-blue a, .broadcast-red a {color:#DDEEFF;} .broadcast-green {background-color:#559955;color:white;padding:2px 4px;} .broadcast-blue {background-color:#6688AA;color:white;padding:2px 4px;} .infobox {border:1px solid #6688AA;padding:2px 4px;} .infobox-limited {max-height:200px;overflow:auto;overflow-x:hidden;} .broadcast-red {background-color:#AA5544;color:white;padding:2px 4px;} .message-learn-canlearn {font-weight:bold;color:#228822;text-decoration:underline;} .message-learn-cannotlearn {font-weight:bold;color:#CC2222;text-decoration:underline;} .message-effect-weak {font-weight:bold;color:#CC2222;} .message-effect-resist {font-weight:bold;color:#6688AA;} .message-effect-immune {font-weight:bold;color:#666666;} .message-learn-list {margin-top:0;margin-bottom:0;} .message-throttle-notice, .message-error {color:#992222;} .message-overflow, .chat small.message-overflow {font-size:0pt;} .message-overflow::before {font-size:9pt;content:\\'...\\';} .subtle {color:#3A4A66;}\\n';\r\n\t\tbuf += '</style>\\n';\r\n\t\tbuf += '<div class=\"wrapper replay-wrapper\" style=\"max-width:1180px;margin:0 auto\">\\n';\r\n\t\tbuf += '<input type=\"hidden\" name=\"replayid\" value=\"' + replayid + '\" />\\n';\r\n\t\tbuf += '<div class=\"battle\"></div><div class=\"battle-log\"></div><div class=\"replay-controls\"></div><div class=\"replay-controls-2\"></div>\\n';\r\n\t\tbuf += `<h1 style=\"font-weight:normal;text-align:center\"><strong>${BattleLog.escapeHTML(battle.tier)}</strong><br /><a href=\"http://${Config.routes.users}/${toID(battle.p1.name)}\" class=\"subtle\" target=\"_blank\">${BattleLog.escapeHTML(battle.p1.name)}</a> vs. <a href=\"http://${Config.routes.users}/${toID(battle.p2.name)}\" class=\"subtle\" target=\"_blank\">${BattleLog.escapeHTML(battle.p2.name)}</a></h1>\\n`;\r\n\t\tbuf += '<script type=\"text/plain\" class=\"battle-log-data\">' + battle.stepQueue.join('\\n').replace(/\\//g, '\\\\/') + '</script>\\n'; // lgtm [js/incomplete-sanitization]\r\n\t\tbuf += '</div>\\n';\r\n\t\tbuf += '<div class=\"battle-log battle-log-inline\"><div class=\"inner\">' + battle.scene.log.elem.innerHTML + '</div></div>\\n';\r\n\t\tbuf += '</div>\\n';\r\n\t\tbuf += '<script>\\n';\r\n\t\tbuf += `let daily = Math.floor(Date.now()/1000/60/60/24);document.write('<script src=\"https://${Config.routes.client}/js/replay-embed.js?version'+daily+'\"></'+'script>');\\n`;\r\n\t\tbuf += '</script>\\n';\r\n\t\treturn buf;\r\n\t}\r\n\r\n\tstatic createReplayFileHref(room: any) {\r\n\t\t// unescape(encodeURIComponent()) is necessary because btoa doesn't support Unicode\r\n\t\t// @ts-ignore\r\n\t\treturn 'data:text/plain;base64,' + encodeURIComponent(btoa(unescape(encodeURIComponent(BattleLog.createReplayFile(room)))));\r\n\t}\r\n}\r\n"],"mappings":"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"}